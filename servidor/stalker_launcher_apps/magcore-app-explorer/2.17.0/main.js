!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=20)}([function(e,t,i){"use strict";var n=i(6);n.back=n.backspace,n.channelNext=n.tab,n.channelPrev=n.tab+"s",n.ok=n.enter,n.exit=n.escape,n.volumeUp=107,n.volumeDown=109,n.f1="112c",n.f2="113c",n.f3="114c",n.f4="115c",n.refresh="116c",n.frame="117c",n.phone="119c",n.set="120c",n.tv="121c",n.menu="122c",n.app="123c",n.rewind="66a",n.forward="70a",n.audio="71a",n.standby="74a",n.keyboard="76a",n.usbMounted="80a",n.usbUnmounted="81a",n.playPause="82a",n.play=-1,n.pause=-1,n.stop="83a",n.power="85a",n.record="87a",n.info="89a",n.mute="192a",n.digit0=48,n.digit1=49,n.digit2=50,n.digit3=51,n.digit4=52,n.digit5=53,n.digit6=54,n.digit7=55,n.digit8=56,n.digit9=57,e.exports=n},function(e,t,i){"use strict";e.exports=i(2)},function(e,t,i){"use strict";var n=i(3),s=i(5),o=0;function a(e){var t,i=this;if(e=e||{},this.visible=!0,this.focusable=!0,this.$node=null,this.$body=null,this.parent=null,this.children=[],this.propagate=!!e.propagate,s.call(this),this.$node=e.$node||document.createElement("div"),this.$body=e.$body||this.$node,this.$node.className=this.name+" "+(e.className||""),this.id=e.id||this.$node.id||"cid"+o++,e.parent&&e.parent.add(this),!1===e.visible&&this.hide(),!1===e.focusable&&(this.focusable=!1),this.defaultEvents)for(t in e.events=e.events||{},this.defaultEvents)e.events[t]=e.events[t]||this.defaultEvents[t];e.events&&Object.keys(e.events).forEach(function(t){i.addListener(t,e.events[t])}),e.children&&this.add.apply(this,e.children),this.$node.addEventListener("click",function(e){i.focus(),i.events["click"]&&i.emit("click",e),e.stopPropagation()}),this.name,this.id,this.name,this.id}a.prototype=Object.create(s.prototype),a.prototype.constructor=a,a.prototype.defaultEvents=null,a.prototype.add=function(e){var t;for(t=0;t<arguments.length;t++)e=arguments[t],this.children.push(e),e.parent=this,e.$node&&null===e.$node.parentNode&&this.$body.appendChild(e.$node),e.name,e.id,this.name,this.id,this.name,this.id,e.name,e.id,this.events["add"]&&this.emit("add",{item:e})},a.prototype.remove=function(){this.parent&&(n.activePage.activeComponent===this&&(this.blur(),this.parent.focus()),this.parent.children.splice(this.parent.children.indexOf(this),1)),this.children.forEach(function(e){e.remove()}),this.$node.parentNode.removeChild(this.$node),this.events["remove"]&&this.emit("remove"),this.events={},this.name,this.id,this.name,this.id},a.prototype.focus=function(e){var t=n.activePage,i=t.activeComponent;return!(!this.focusable||this===i)&&(i&&i.blur(),t.activeComponent=i=this,i.$node.classList.add("focus"),this.name,this.id,this.name,this.id,i.events["focus"]&&i.emit("focus",e),!0)},a.prototype.blur=function(){var e=n.activePage,t=e.activeComponent;return this.$node.classList.remove("focus"),this===t?(e.activeComponent=null,this.name,this.id,this.name,this.id,this.events["blur"]&&this.emit("blur"),!0):(this.name,this.id,this.name,this.id,!1)},a.prototype.show=function(e,t){return!this.visible&&(this.$node.classList.remove("hidden"),this.visible=!0,this.name,this.id,this.name,this.id,this.events["show"]&&this.emit("show",e),"function"==typeof t&&setTimeout(t),!0)},a.prototype.hide=function(e){return!!this.visible&&(this.$node.classList.add("hidden"),this.visible=!1,this.name,this.id,this.name,this.id,this.events["hide"]&&this.emit("hide"),"function"==typeof e&&setTimeout(e),!0)},e.exports=a},function(e,t,i){"use strict";var n=i(5),s=i(22).parse,o=new n;o.query=s(document.location.search.substring(1)),o.config=i(23),o.activePage=null,o.route=function(e,t){var i,n=o.activePage;return!(!e||e.active)&&(e.name,e.id,e.name,e.id,(i=o.activePage)&&i.active&&(i.$node.classList.remove("active"),i.active=!1,o.activePage=null,i.name,i.id,i.name,i.id,i.events["hide"]&&i.emit("hide")),function(e,t){!e||e.active||(e.$node.classList.add("active"),e.active=!0,o.activePage=e,e.name,e.id,e.name,e.id,e.events["show"]&&e.emit("show",{data:t}))}(e,t),this.events["route"]&&this.emit("route",{from:n,to:e}),!0)},e.exports=o},function(e,t,i){"use strict";var n=i(21);e.exports=n},function(e,t,i){"use strict";function n(){this.events={}}n.prototype={addListener:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},once:function(e,t){var i=this;this.events[e]=this.events[e]||[],this.events[e].push(function n(){i.removeListener(e,n),t.apply(i,arguments)})},addListeners:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.addListener(t,e[t])},removeListener:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(function(e){return e!==t}),0===this.events[e].length&&(this.events[e]=void 0))},emit:function(e){var t,i=this.events[e];if(i)for(t=0;t<i.length;t++)i[t].apply(this,Array.prototype.slice.call(arguments,1))}},n.prototype.constructor=n,e.exports=n},function(e,t,i){"use strict";e.exports={backspace:8,tab:9,enter:13,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46}},function(e,t,i){"use strict";var n=i(8),s=i(13);function o(e){var t=this;e=e||{},this.handlers={},this.links={},this.$noData=null,e.propagate=void 0===e.propagate||e.propagate,this.fixedData=e.fixedData||!1,e.$body=document.createElement("div"),e.$body.className="body",this.$noData=document.createElement("div"),this.$noData.className="noData hidden",n.call(this,e),this.$node.appendChild(this.$body),this.$node.appendChild(this.$noData),this.addListener("click:item",function(e){e.$item.layout.children.length&&!e.inner&&e.$item.layout.children[e.$item.layout.focusIndex].focus(),e.inner&&(t.focus(),t.focusItem(e.$item)),t.handlers[e.$item.index]&&t.handlers[e.$item.index](e.$item)})}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.name="mag-component-layout-list",o.prototype.renderItemDefault=function(e,t){var i,n,o,a,r;if(e.ready&&this.fixedData)for(r=0;r<t.items.length;r++)"string"!=typeof(a=t.items[r]).value&&void 0!==a.value||((o=e.layout.$node.childNodes[r]).innerText=a.value||"",o.className=a.className||"");else{for(;e.firstChild;)e.removeChild(e.firstChild);n={focusable:!1,data:t.items},t.className&&(n.className=t.className),i=new s(n),t.name&&(this.links[t.name]=i),e.appendChild(i.$node),e.layout=i,i.parent=this,i.$parentItem=e,i.addListener("click",function(){i.parent.emit("click:item",{$item:e,inner:!0})}),t.click&&(this.handlers[e.index]=t.click),e.ready=!0}e.value=t.value||{}},o.prototype.setData=function(e){this.links={},n.prototype.setData.call(this,e),e.data&&e.data.length?this.$noData.classList.add("hidden"):this.$noData.classList.remove("hidden")},o.prototype.init=function(e){var t;n.prototype.init.call(this,e),e.noData&&(this.$noData.innerHTML="",e.noData instanceof Element?this.$noData.appendChild(e.noData):"string"==typeof e.noData&&((t=document.createElement("div")).innerText=e.noData,this.$noData.appendChild(t))),e.data&&e.data.length?this.$noData.classList.add("hidden"):this.$noData.classList.remove("hidden")},o.prototype.renderItem=o.prototype.renderItemDefault,e.exports=o},function(e,t,i){"use strict";var n=i(1),s=i(0);function o(e){e=e||{},this.$focusItem=null,this.viewIndex=null,this.data=[],this.type=this.TYPE_VERTICAL,this.size=5,this.cycle=!1,this.scroll=null,e.type&&(this.type=e.type),this.provider=null,this.type===this.TYPE_HORIZONTAL&&(e.className+=" horizontal"),n.call(this,e),this.init(e)}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.name="mag-component-list",o.prototype.TYPE_VERTICAL=1,o.prototype.TYPE_HORIZONTAL=2,o.prototype.renderItemDefault=function(e,t){e.innerText=t.value},o.prototype.renderItem=o.prototype.renderItemDefault,o.prototype.defaultEvents={mousewheel:function(e){this.type===this.TYPE_VERTICAL&&e.wheelDeltaY&&this.move(e.wheelDeltaY>0?s.up:s.down),this.type===this.TYPE_HORIZONTAL&&e.wheelDeltaX&&this.move(e.wheelDeltaX>0?s.left:s.right)},keydown:function(e){switch(e.code){case s.up:case s.down:case s.right:case s.left:case s.pageUp:case s.pageDown:case s.home:case s.end:this.move(e.code);break;case s.enter:this.events["click:item"]&&this.$focusItem&&this.emit("click:item",{$item:this.$focusItem,event:e})}}},o.prototype.init=function(e){var t,i,n=this,s=this.$body.children.length,o=function(e){this.data&&(n.focusItem(this),n.events["click:item"]&&n.emit("click:item",{$item:this,event:e}))};if(void 0!==e.cycle&&(this.cycle=e.cycle),e.scroll&&(this.scroll=e.scroll),e.provider&&(this.provider=e.provider),e.render&&(this.renderItem=e.render),e.size&&(this.size=e.size),e.events&&Object.keys(e.events).forEach(function(t){n.events[t]=null,n.addListener(t,e.events[t])}),this.size!==s)for(s>0&&(this.$body.innerText=null),i=0;i<this.size;i++)(t=document.createElement("div")).index=i,t.className="item",t.addEventListener("click",o),this.$body.appendChild(t);if(this.provider){if(this.provider.blocked)return;this.provider.get(null,function(t,i){t?n.events["data:error"]&&n.emit("data:error",t):(i&&(e.data=i,n.setData(e),n.scroll&&n.scroll.init({realSize:n.provider.maxCount,viewSize:n.provider.size,value:n.provider.head+n.provider.pos})),n.events["data:get"]&&n.emit("data:get"))})}else e.data&&this.setData(e)},o.prototype.setData=function(e){e.data&&(this.data=function(e){var t;for(t=0;t<e.length;t++)"object"!=typeof e[t]&&(e[t]={value:e[t]});return e}(e.data)),this.viewIndex=null,this.$focusItem&&this.blurItem(this.$focusItem),this.scroll&&(this.provider?this.scroll.realSize!==this.provider.maxCount&&this.scroll.init({realSize:this.provider.maxCount,viewSize:this.provider.size,value:this.provider.head+this.provider.pos}):this.scroll.init({realSize:this.data.length,viewSize:this.size,value:e.viewIndex||0})),void 0!==e.focusIndex&&this.data.length?this.focusIndex(e.focusIndex):this.renderView(e.viewIndex||0)},o.prototype.renderView=function(e){var t,i,n,s,o;if(this.viewIndex!==e){for(s=this.viewIndex,this.viewIndex=o=e,i=0;i<this.size;i++)t=this.$body.children[i],(n=this.data[e])?(t.data=n,t.index=e,this.renderItem(t,n),n.mark?t.classList.add("mark"):t.classList.remove("mark")):(t.data=t.index=void 0,t.innerHTML="&nbsp;",t.ready=!1),e++;return this.events["move:view"]&&this.emit("move:view",{prevIndex:s,currIndex:o}),this.events["select:item"]&&this.emit("select:item",{$item:t}),this.scroll&&this.scroll.scrollTo(this.provider?this.provider.head+this.provider.pos:this.viewIndex),!0}return!1},o.prototype.move=function(e){var t=this,i=!1;if(this.data.length)switch(e){case s.left:if(this.type!==this.TYPE_HORIZONTAL)break;i=!0;case s.up:if(i||this.type===this.TYPE_VERTICAL)if(this.$focusItem&&this.$focusItem.index>0)this.$focusItem===this.$body.firstChild?this.renderView(this.viewIndex-1):this.focusItem(this.$focusItem.previousSibling);else if(this.provider){if(this.provider.blocked)return;this.provider.get(e,function(e,i,n){e?t.events["data:error"]&&t.emit("data:error",e):i&&t.setData({data:i,focusIndex:n||0===n?n:t.$focusItem.index})})}else this.cycle&&this.move(s.end),this.events["overflow"]&&this.emit("overflow",{direction:e,cycle:this.cycle});break;case s.right:if(this.type!==this.TYPE_HORIZONTAL)break;i=!0;case s.down:if(i||this.type===this.TYPE_VERTICAL)if(this.$focusItem&&this.$focusItem.index<this.data.length-1)this.$focusItem===this.$body.lastChild?this.renderView(this.viewIndex+1):this.focusItem(this.$focusItem.nextSibling);else if(this.provider){if(this.provider.blocked)return;this.provider.get(e,function(e,i,n){e?t.events["data:error"]&&t.emit("data:error",e):i&&t.setData({data:i,focusIndex:n||0===n?n:t.$focusItem.index})})}else this.cycle&&this.move(s.home),this.events["overflow"]&&this.emit("overflow",{direction:e,cycle:this.cycle});break;case s.pageUp:if(this.provider){if(this.provider.blocked)return;return void this.provider.get(e,function(e,i,n){e?t.events["data:error"]&&t.emit("data:error",e):i&&t.setData({data:i,focusIndex:n||0})})}this.viewIndex<this.size?this.renderView(0):this.renderView(this.viewIndex-this.size+1),this.focusItem(this.$body.firstChild);break;case s.pageDown:if(this.provider){if(this.provider.blocked)return;this.provider.get(e,function(e,i,n){var s;e?t.events["data:error"]&&t.emit("data:error",e):i&&(s=n||0===n?n:i.length<t.size?i.length-1:t.size-1,t.setData({data:i,focusIndex:s}))});break}this.data.length>this.size?(this.viewIndex>this.data.length-2*this.size?this.renderView(this.data.length-this.size):this.renderView(this.viewIndex+this.size-1),this.focusItem(this.$body.lastChild)):this.focusItem(this.$body.children[this.data.length-1]);break;case s.home:if(this.provider){if(this.provider.blocked)return;this.provider.get(e,function(e,i,n){e?t.events["data:error"]&&t.emit("data:error",e):i&&t.setData({data:i,focusIndex:n||0})});break}this.renderView(0),this.focusItem(this.$body.firstChild);break;case s.end:if(this.provider){if(this.provider.blocked)return;this.provider.get(e,function(e,i,n){var s;e?t.events["data:error"]&&t.emit("data:error",e):i&&(s=n||0===n?n:i.length<t.size?i.length-1:t.size-1,t.setData({data:i,focusIndex:s}))});break}this.data.length>this.size?(this.renderView(this.data.length-this.size),this.focusItem(this.$body.lastChild)):this.focusItem(this.$body.children[this.data.length-1])}},o.prototype.focusItem=function(e){var t=this.$focusItem;return!(!e||t===e)&&(null!==t&&(t.classList.remove("focus"),this.events["blur:item"]&&this.emit("blur:item",{$item:t})),this.$focusItem=e,this.$focusItem.data=this.data[this.$focusItem.index],e.classList.add("focus"),this.events["focus:item"]&&this.emit("focus:item",{$prev:t,$curr:e}),this.events["select:item"]&&this.emit("select:item",{$item:e}),!0)},o.prototype.blurItem=function(e){return!!e&&(e===this.$focusItem&&(this.$focusItem=null),e.classList.remove("focus"),this.events["blur:item"]&&this.emit("blur:item",{$item:e}),!0)},o.prototype.focusIndex=function(e){var t=this.viewIndex||0;e>=t+this.size?(e=e<this.data.length-1?e:this.data.length-1,this.renderView(e-this.size+1),this.focusItem(this.$body.lastChild)):e<t?(e=e>0?e:0,this.renderView(e),this.focusItem(this.$body.firstChild)):(null===this.viewIndex&&this.renderView(0),this.focusItem(this.$body.children[e-t]))},o.prototype.markItem=function(e,t){t?e.classList.add("mark"):e.classList.remove("mark"),e.data.mark=t},e.exports=o},function(e,t,i){"use strict";var n=i(32),s=i(1),o=i(0);function a(e){var t,i,s,a=this;(e=e||{}).events=e.events||{},e.focusable=e.focusable||!1,e.visible=e.visible||!1,e.events.click=e.events.click||function(){a.hide()},s=e.events.keydown,e.events.keydown=function(e){s&&s.call(this,e),e.code!==o.back&&e.code!==o.menu||(e.stop=!0,a.hide())},n.call(this,e),this.$node.appendChild(document.createElement("div")),this.$node.firstChild.classList.add("alignBox"),this.$node.firstChild.appendChild(document.createElement("div")),this.$header=document.createElement("div"),this.$header.className="header",this.$text=this.$header.appendChild(document.createElement("div")),this.$text.classList.add("text"),this.$text.innerText=e.title||"",e.icon&&(this.$icon=this.$header.appendChild(document.createElement("div")),this.$icon.className="icon "+e.icon),(t=document.createElement("div")).className="overlay",i=this.$body.parentNode.removeChild(this.$body),this.$node.firstChild.firstChild.appendChild(this.$header),this.$node.firstChild.firstChild.appendChild(i),this.$node.firstChild.firstChild.appendChild(t)}a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.name="mag-component-modal",a.prototype.focus=function(){this.$node.classList.add("active"),n.prototype.focus.call(this),this.children[0]&&this.children[0]instanceof s&&this.children[0].focus()},a.prototype.blur=function(){this.$node.classList.remove("active"),n.prototype.blur.call(this)},e.exports=a},function(e,t,i){"use strict";var n={fs:["Unknown","FAT16","FAT32","EXT2","EXT3","NTFS","EXT4"],media:{init:{id:0},favorite:{id:1,opener:null},network:{id:10},smb:{id:20,opener:null},smbWorkgroup:21,smbServer:22,smbShare:23,smbPermanentShare:{id:24,opener:null},nfs:{id:30,opener:null},nfsServer:31,nfsShare:32,nfsPermanentShare:{id:33,opener:null},upnp:{id:40,opener:null},upnpServer:41,upnpHost:42,upnpDir:43,folder:{id:50,opener:null},file:60,fileVideo:{id:61,icon:"theme-icon-video",opener:null,mime:"content/video",extensions:["mpg","mpeg","mov","mp4","avi","mkv","3gp","ts","trp","vob","wmv","mts","m2t","m2v","divx","m2ts","m2p","tp","flv","mod","tod","asf","tts","m4v"]},fileAudio:{id:62,icon:"theme-icon-audio",opener:null,mime:"content/audio",extensions:["mp3","wav","ac3","ogg","oga","aiff","wv","tta","wma","aac","dts","flac","ape","m4a"]},fileImage:{id:63,icon:"theme-icon-image",opener:null,mime:"content/image",extensions:["jpg","jpeg","png","bmp","gif","tif","tiff"]},fileText:{id:64,icon:"theme-icon-text",opener:null,extensions:["txt","srt","sub","ass"]},fileCUE:{id:65,icon:"theme-icon-cue",opener:null,extensions:["cue"]},fileISO:{id:66,icon:"theme-icon-iso",opener:null,mime:"content/video",extensions:["iso"]},fileRecords:{id:67,icon:"theme-icon-record",opener:null,extensions:["tspinf"]},filePlaylist:{id:68,icon:"theme-icon-playlist",opener:null,extensions:["m3u","m3u8"]},fileStream:{id:69,icon:"theme-icon-stream",opener:null,mime:"content/media",extensions:[""]}},idToMedia:{}};Object.keys(n.media).forEach(function(e){n.idToMedia[n.media[e].id]=n.media[e]}),e.exports=n},function(e,t,i){"use strict";var n=i(3);e.exports=function(e){var t=document.createElement("link");t.rel="stylesheet",t.href="css/"+e+"."+n.metrics.height+".css",document.head.appendChild(t)}},function(e,t,i){"use strict";var n=i(1),s=i(13);function o(e){var t;e=e||{},this.size=1,this.main=!1,this.index=0,e.$body=document.createElement("div"),e.$body.className="body",n.call(this,e),e.size&&(this.size=e.size,this.$node.classList.add("size"+e.size)),e.main&&(this.main=!0,this.$node.classList.add("main")),this.shadows={$left:document.createElement("div"),$right:document.createElement("div")},this.shadows.$left.className="shadow left",this.$node.appendChild(this.shadows.$left),this.shadows.$right.className="shadow right",this.$node.appendChild(this.shadows.$right),e.title&&(Array.isArray(e.title)||(e.title=[e.title]),this.title=new s({className:"title",data:e.title,focusable:!1}),this.$node.appendChild(this.title.$node)),this.$node.appendChild(this.$body),(t=document.createElement("div")).className="overlay",this.$node.appendChild(t)}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.name="mag-component-panel",o.prototype.defaultEvents={focus:function(){this.children.length&&this.children[0].focus()}},o.prototype.focus=function(){this.focusable&&(this.parent.panels[this.parent.focusIndex].$node.classList.remove("active"),this.parent.panels[this.parent.focusIndex].$node.classList.remove("top"),n.prototype.focus.call(this),this.parent.focusIndex=this.index,this.$node.classList.add("active"),this.$node.classList.add("top"),0===this.index&&this.parent.panels[1]&&this.parent.panels[1].main?(this.parent.panels[1].$node.classList.remove("position-left"),this.parent.panels[1].$node.classList.add("position-right"),this.parent.panels[2]&&this.parent.panels[2].$node.classList.remove("expand"),this.$node.classList.add("expand")):2===this.index&&this.parent.panels[1].main&&(this.parent.panels[1].$node.classList.remove("position-right"),this.parent.panels[1].$node.classList.add("position-left"),this.parent.panels[0].$node.classList.remove("expand"),this.$node.classList.add("expand")))},o.prototype.blur=function(){this.parent.panels[this.parent.focusIndex].$node.classList.remove("active"),n.prototype.blur.call(this)},e.exports=o},function(e,t,i){"use strict";var n=i(1),s=i(0);function o(e){var t=this;e=e||{},this.focusIndex=0,this.data=[],this.links={},n.call(this,e),this.init(e),this.addListener("keydown",function(e){switch(e.code){case s.right:t.children.length&&t.focusIndex<t.children.length-1&&t.children[++t.focusIndex].focus();break;case s.left:t.children.length&&t.focusIndex>0&&t.children[--t.focusIndex].focus();break;case s.back:t.parent&&(t.parent.focus(),t.$parentItem&&t.parent.focusItem(t.$parentItem))}})}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.name="mag-component-layout",o.prototype.init=function(e){for(var t,i,s,o=this,a=function(e){var t,i;for(t=0;t<e.length;t++)"object"==typeof(i=e[t])?i instanceof n||i instanceof HTMLElement?e[t]={value:i,wrap:!1}:e[t].wrap=!0:e[t]={value:e[t],wrap:!0};return e}(e.data);this.$node.firstChild;)this.$node.removeChild(this.$node.firstChild);function r(){o.focusIndex=this.index}for(this.data=a,s=0;s<a.length;s++)"string"==typeof(t=a[s]).value?((i=document.createElement("div")).textContent=t.value,t.className&&(i.className=t.className),this.$node.appendChild(i),t.name&&(this.links[t.name]=i)):t.value instanceof HTMLElement?t.wrap?(i=document.createElement("div"),t.className&&(i.className=t.className),i.appendChild(t.value),this.$node.appendChild(i),t.name&&(this.links[t.name]=i)):(this.$node.appendChild(t.value),t.name&&(this.links[t.name]=t.value)):t.value instanceof n?(t.value.propagate=!0,t.value.index=this.children.length,t.value.addListener("click",r),t.wrap?(i=document.createElement("div"),t.className&&(i.className=t.className),i.appendChild(t.value.$node),this.$node.appendChild(i),this.children.push(t.value),t.value.parent=this,t.name&&(this.links[t.name]=i)):(this.add(t.value),t.name&&(this.links[t.name]=t.value))):(i=document.createElement("div"),t.className&&(i.className=t.className),this.$node.appendChild(i),t.name&&(this.links[t.name]=i))},e.exports=o},function(e,t,i){"use strict";var n=i(1),s=i(0);function o(e){var t,i=this;function o(e){switch(e.code){case s.left:i.focusIndex>0&&i.panels[i.focusIndex-1].focus();break;case s.right:i.focusIndex<i.panels.length-1&&i.panels[i.focusIndex+1].focus()}}for((e=e||{}).focusable=e.focusable||!1,n.call(this,e),this.panels=e.panels,this.focusIndex=0,e.panels&&!e.panels[0].main&&(e.panels[0].$node.classList.add("left"),e.panels[0].$node.classList.add("expand")),e.panels&&e.panels[1]&&e.panels[1].main&&e.panels[1].$node.classList.add("position-right"),e.panels&&e.panels[2]&&e.panels[1].main&&e.panels[2].$node.classList.add("right"),e.panels&&this.add.apply(this,e.panels),t=0;t<this.panels.length;t++)this.panels[t].addListeners({keydown:o}),this.panels[t].index=t}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.name="mag-component-panel-set",o.prototype.focus=function(){n.prototype.focus.call(this),this.panels[this.focusIndex].focus()},o.prototype.blur=function(){this.panels[this.focusIndex].blur()},e.exports=o},function(e,t,i){"use strict";e.exports=i(39),e.exports.prototype.name="stb-component-button"},function(e,t,i){"use strict";var n={tag:function(e,t,i){var n,s,o=null;if(e){if(o=document.createElement(e),t&&"object"==typeof t)for(s in t)o[s]=t[s];for(n=2;n<arguments.length;n++)arguments[n]&&o.appendChild("object"==typeof arguments[n]?arguments[n]:document.createTextNode(arguments[n]))}return o},fragment:function(e){var t,i=document.createDocumentFragment();for(t=0;t<arguments.length;t++)(e=arguments[t])&&i.appendChild("object"==typeof e?e:document.createTextNode(e));return i},add:function(e,t){var i;if(e instanceof Node){for(i=1;i<arguments.length;i++)arguments[i]&&e.appendChild("object"==typeof arguments[i]?arguments[i]:document.createTextNode(arguments[i]));return e}return null},remove:function(e){var t,i=0;for(t=0;t<arguments.length;t++)arguments[t]&&arguments[t].parentNode&&arguments[t].parentNode.removeChild(arguments[t])===arguments[t]&&i++;return arguments.length>0&&i===arguments.length},clear:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)}};e.exports=n},function(e,t,i){"use strict";t.open=function(e,t){core.intent({action:"keyboard",data:{type:e.type,mode:e.mode,title:e.title,value:e.value},events:{done:function(e){t&&t(e)}}},function(e){})}},function(e,t,i){"use strict";e.exports=function(e,t){return t||(t=1),e>=0&&e<1024?e+" B":e>=1024&&e<1048576?(e/1024).toFixed(t)+" KB":e>=1048576&&e<1073741824?(e/1048576).toFixed(t)+" MB":e>=1073741824&&e<1099511627776?(e/1073741824).toFixed(t)+" GB":e>=1099511627776?(e/1099511627776).toFixed(t)+" TB":e+" B"}},function(e,t,i){"use strict";e.exports=i(53),e.exports.prototype.name="stb-component-page"},function(e,t,i){"use strict";var n=i(4);n.once("load",function(){i(29).load({name:core.environment.language},function(){n.storage={favoritesStorage:[],network:{smb:[],nfs:[]}},n.environment={get UPnPMode(){return core.plugins.upnp.getState()},get readOnlyMode(){return core.plugins.fs.getReadOnlyState()}},n.runtime={isModalShown:!1,isSearched:!1,stillWaitNetworkResponse:!1,openShareAttempts:0,currentServer:"",currentShare:""},n.pages={main:i(31),connect:i(54)},n.route(n.pages.main),n.ready()})})},function(e,t,i){"use strict";var n=i(3),s=i(24);window.core=window.parent.getCoreInstance(window,n),i(25),i(26),i(11)("sdk"),i(28),i(11)("app"),n.platform="mag",n.ready=function(){window.core.call("app:ready")},n.exit=function(){n.events["exit"]&&n.emit("exit"),core.call("exit")},s.load=function(e){document.body.setAttribute("platform",n.platform),core.ready?n.events["load"]&&n.emit("load",{}):core.once("load",function(){n.events[e.type]&&n.emit(e.type,e)})},s.contextmenu=function(e){e.preventDefault()},Object.keys(s).forEach(function(e){window.addEventListener(e,s[e])}),e.exports=n},function(e,t,i){"use strict";e.exports={parse:function(e){var t={};return e.split("&").forEach(function(e){2===(e=e.split("=")).length&&(t[e[0]]=decodeURIComponent(e[1]))}),t},stringify:function(e){var t=[];return Object.keys(e).forEach(function(i){t.push(i+"="+encodeURIComponent(e[i]))}),t.join("&")}}},function(e,t,i){"use strict";e.exports={mountPathBase:"/ram/mnt",mountPathSMB:"/ram/mnt/smb",mountPathNFS:"/ram/mnt/nfs",defaultListSize:7}},function(e,t,i){"use strict";var n=i(3);e.exports={DOMContentLoaded:function(e){n.events["dom"]&&n.emit("dom",e)},load:function(e){n.events[e.type]&&n.emit(e.type,e)},unload:function(e){n.events[e.type]&&n.emit(e.type,e)},error:function(e){},keydown:function(e){var t,i=n.activePage,s={code:e.keyCode,stop:!1};e.ctrlKey&&(s.code+="c"),e.altKey&&(s.code+="a"),e.shiftKey&&(s.code+="s"),(t=i.activeComponent)&&t!==i&&(t.events[e.type]&&t.emit(e.type,s,e),!s.stop&&t.propagate&&t.parent&&t.parent.events[e.type]&&t.parent.emit(e.type,s,e)),s.stop||(i.events[e.type]&&i.emit(e.type,s,e),e.stop||n.events[e.type]&&n.emit(e.type,s,e))},keypress:function(e){var t=n.activePage;t.activeComponent&&t.activeComponent!==t&&t.activeComponent.events[e.type]&&t.activeComponent.emit(e.type,e)},mousewheel:function(e){var t=n.activePage;t.activeComponent&&t.activeComponent!==t&&t.activeComponent.events[e.type]&&t.activeComponent.emit(e.type,e),e.stop||t.events[e.type]&&t.emit(e.type,e)}}},function(e,t,i){"use strict";if(!document.documentElement.classList){var n=Array.prototype,s=n.indexOf,o=n.slice,a=n.push,r=n.splice,l=n.join;window.DOMTokenList=function(e){if(this._element=e,e.className!==this._classCache){if(this._classCache=e.className,!this._classCache)return;var t,i=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/);for(t=0;t<i.length;t++)a.call(this,i[t])}},window.DOMTokenList.prototype={add:function(e){this.contains(e)||(a.call(this,e),this._element.className=o.call(this,0).join(" "))},contains:function(e){return-1!==s.call(this,e)},item:function(e){return this[e]||null},remove:function(e){var t=s.call(this,e);-1!==t&&(r.call(this,t,1),this._element.className=o.call(this,0).join(" "))},toString:function(){return l.call(this," ")},toggle:function(e){return this.contains(e)?this.remove(e):this.add(e),this.contains(e)}},Object.defineProperty(Element.prototype,"classList",{get:function(){return new window.DOMTokenList(this)}})}},function(e,t,i){"use strict";var n=i(3),s=i(27);n.metrics=s[n.query.screenHeight]||s[screen.height]||s[720],n.metrics.availHeight=n.metrics.height-(n.metrics.availTop+n.metrics.availBottom),n.metrics.availWidth=n.metrics.width-(n.metrics.availLeft+n.metrics.availRight)},function(e,t,i){"use strict";e.exports={480:{height:480,width:720,availTop:24,availBottom:24,availRight:32,availLeft:48},576:{height:576,width:720,availTop:24,availBottom:24,availRight:26,availLeft:54},720:{height:720,width:1280,availTop:30,availBottom:30,availRight:40,availLeft:40},1080:{height:1080,width:1920,availTop:45,availBottom:45,availRight:60,availLeft:60}}},function(e,t,i){"use strict";var n,s=i(3);(n=document.createElement("link")).rel="stylesheet",n.href=window.core.theme.path+s.metrics.height+".css",document.head.appendChild(n),e.exports=n},function(e,t,i){"use strict";var n=i(5),s=i(30),o=new n;function a(e){var t=new s(e);return window.gettext=window._=t.gettext,window.pgettext=t.pgettext,window.ngettext=t.ngettext,t}o.defaultLanguage="en",o.load=function(e,t){var i;return e.ext=e.ext||"json",e.path=e.path||"lang",e.name===o.defaultLanguage?(a(),t(null),!1):((i=new XMLHttpRequest).onload=function(){try{a(JSON.parse(i.responseText)),t(null),o.events["load"]&&o.emit("load")}catch(e){i.onerror(e)}},i.ontimeout=i.onerror=function(e){a(),t(e),o.events["error"]&&o.emit("error",e)},i.open("GET",e.path+"/"+e.name+"."+e.ext,!0),i.send(null),!0)},e.exports=o},function(module,exports,__webpack_require__){"use strict";function Gettext(config){var data,meta;config=config||{},data=config.data||{},data[""]=data[""]||{},meta=config.meta,this.gettext=function(e){return data[""][e]||e},this.pgettext=function(e,t){return data[e]&&data[e][t]||t},this.ngettext=function(msgId,plural,value){var n,evalResult;return data&&meta&&data[""][msgId]?(evalResult=eval("n = "+value+"; "+meta.plural),"boolean"==typeof evalResult&&(evalResult=+evalResult),data[""][msgId][evalResult]):1===value?msgId:plural}}Gettext.prototype.constructor=Gettext,module.exports=Gettext},function(e,t,i){"use strict";var n,s,o,a,r,l,c,d,u,h,p,f,m,v,g,y,x,b,w,S,N,$,k,I,C,T,E,D=i(4),L=i(12),P=i(14),R=i(7),F=i(9),O=i(34),A=i(36),z=i(37),M=i(38),j=i(0),B=i(15),W=i(40),_=i(42),U=i(16),H=i(43),V=i(10),q=i(44),Y=i(17),G=i(45),J=i(46),X=i(47),Z=i(48),K=i(49),Q=i(50),ee=i(18),te=i(51),ie=i(52),ne=new(i(19))({$node:window.pageMain}),se=V.media,oe=core.notify,ae=core.plugins.fs,re=core.plugins.ufsJson,le=core.plugins.upnp,ce=U.tag,de=D.environment.UPnPMode,ue=D.config.defaultListSize,he=[],pe=[],fe=[],me={},ve={},ge={},ye="NAME",xe=null,be=[{items:[{className:"theme-icon theme-icon-back"},".."],click:_e}],we={playlistFile:0,playlistStream:1};function Se(e,t){return X.searchRequest?Array.isArray(e)?e.filter(function(e){return s.test(e[t])}):[]:e}function Ne(){Object.keys(ge).forEach(function(e){ge[e].hide()}),c.focus(),D.runtime.isModalShown=!1,D.runtime.openShareAttempts=0,d.$node.classList.contains("active")&&ne.footer.show()}function $e(e){var t,i={middle:[]};return e[0].length&&(t=e[0][0]===j.menu?e[0][1]?e[0][1]:function(){ge.actions.show(),ne.footer.hide()}:e[0][1]||function(){},i.left={code:e[0][0],action:t}),e[1].forEach(function(e){i.middle.push({code:e[0],title:e[1]||"",action:e[2]||function(){}})}),ne.footer.init(i),ne.footer}function ke(){return y.innerText=gettext("All"),y.previousElementSibling.classList.remove("active"),gettext("All")}function Ie(e){me={},e.forEach(function(e){me[e.type]?me[e.type].push(e):me[e.type]=[e]})}function Ce(e){var t=he.concat(pe),i=he.slice(),n=t.filter(function(e){return 10===e.value.type});switch(e){case ye="NAME":return i.sort(function(e,t){return e.value.name.toLowerCase().localeCompare(t.value.name.toLowerCase())}),n.sort(function(e,t){return e.value.name.toLowerCase().localeCompare(t.value.name.toLowerCase())}),be.concat(i,n);case ye="DATE":return n.sort(function(e,t){return e.value.item.lastModified-t.value.item.lastModified}),be.concat(he,n);case ye="TYPE":return n.sort(function(e,t){return e.value.item.extension.toLowerCase().localeCompare(t.value.item.extension.toLowerCase())}),be.concat(he,n);case ye="SIZE":return n.sort(function(e,t){return e.value.item.size-t.value.item.size}),be.concat(he,n)}return be.concat(t)}function Te(e,t,i){var n,s,r;if(1===t)n=Se(e.dirs,"name"),Ie(s=(s=Se(e.files,"name")).map(function(e){var t;if(e.path&&-1!==e.path.indexOf("://")?(e.extension="",e.subtype=we.playlistStream):void 0===e.size?(e.extension=e.extension||e.path.split(".").pop().toLowerCase(),e.subtype=we.playlistFile):e.extension=e.extension||e.name.split(".").pop().toLowerCase(),!e.type)for(t in se)if(se[t].extensions&&-1!==se[t].extensions.indexOf(e.extension)){e.type=se[t].id;break}return e.mime=V.idToMedia[e.type].mime,e})),n=n.map(function(e){var t,i="theme-icon",n=!1;for(t=0;t<D.storage.favoritesStorage.length;t+=1)if(D.storage.favoritesStorage[t].path===(e.path||Z.path+e.name)){i="theme-icon theme-icon-favorite-active active",n=!0;break}return{items:[{className:"theme-icon theme-icon-folder"},{value:e.name,className:"listDirNameField"},{className:i}],value:{name:e.name,type:9,isFavorite:n,item:e},click:function(){var t;function i(){ae.readDir(t,function(e,t){e||(Z.config.currentDirFilesCount=t.dirs.length+t.files.length,Ee(Te(t,1),x,{focusIndex:0}),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]),je(m.types))})}Z.push({index:p.$focusItem.index,path:Z.config.isDisplayFavorites&&!Z.length?e.path:e.name}),t=Z.path,Z.config.isDisplayNfsShare&&Z.config.currentDeviceType!==se.nfsPermanentShare&&(t=Z.path.split("/").slice(3).join("/")),-1===["VIDEO_TS","BDMV","video_ts","bdmv","video_ts.ifo","VIDEO_TS.IFO"].indexOf(e.name)?i():oe({title:gettext("Do you want to play the folder content?"),icon:"info",type:"",buttons:[{value:gettext("Cancel"),click:i},{value:gettext("Play"),click:function(){se.folder.opener(e,{type:"dvd"})}}]}),g.innerText=e.name,y.innerText=m.title.length?m.title.join(", "):ke()}}}),s=s.map(function(e){var t,i,n,s="theme-icon",o=!1;for(n=0;n<D.storage.favoritesStorage.length;n+=1)if(D.storage.favoritesStorage[n].path===(e.path||Z.path+e.name)){s="theme-icon theme-icon-favorite-active active",o=!0;break}for(i in se)if(se[i].extensions&&-1!==se[i].extensions.indexOf(e.extension)){t=se[i].icon;break}return{items:[{className:"theme-icon "+t+(1===Z.config.type?" listDirFileIcon":"")},{value:e.name,className:"listDirNameField"},{className:s}],value:{name:e.name,type:10,item:e,isFavorite:o},click:function(){V.idToMedia[e.type].opener?(e.type===se.filePlaylist.id&&(Z.config.isDisplayPlaylist=!0),V.idToMedia[e.type].opener(e)):oe({title:gettext("Can not open this type of file"),icon:"info"})}}});else{if(t===se.network.id)return e=(e||[]).map(function(e){var t,n,s="",o=e.name,a=D.storage.network.smb;if(i&&i.favSharesPresent)for(n=(t=a.slice(i.index)).length;n--;)if(t[n].name===o){s=" active";break}return{items:[{className:"theme-icon "+(i&&i.icon||"theme-icon-network")+s},e.name],click:function(){D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,1===Z.length?(Z.push({index:p.$focusItem.index,path:{group:e.name,uri:e.uri},type:se.smbWorkgroup}),De("getServers",Z.head.path,{icon:"theme-icon-server"},function(){g.innerText=gettext("servers"),D.runtime.stillWaitNetworkResponse=!1})):2===Z.length?(Z.push({index:p.$focusItem.index,path:D.runtime.currentServer=e.name,type:se.smbServer}),De("getShares",{server:Z.head.path},{icon:"theme-icon-shared-folder"},function(){Z.length<3&&Z.push({index:p.$focusItem.index,path:e.name,type:se.smbServer}),g.innerText="SAMBA",D.runtime.stillWaitNetworkResponse=!1})):3===Z.length&&De("openShare",{addresses:e.addresses,folder:e.name,mountPath:D.config.mountPathSMB},{},function(){g.innerText=e.name,y.innerText=m.title.length?m.title.join(", "):ke(),D.runtime.stillWaitNetworkResponse=!1}))},value:{item:e}}}),be.concat(e);if(t===se.nfsServer)return e=(e||[]).map(function(e){return{items:[{className:"theme-icon theme-icon-server"},e],click:function(){D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,Z.push({index:p.$focusItem.index,path:D.runtime.currentServer=e,type:se.nfsShare}),Le("getShares",{server:Z.head.path},{icon:"theme-icon-shared-folder"}))},value:{item:e}}}),be.concat(e);if(t===se.nfsShare)return e=(e||[]).map(function(e,t){return{items:[{className:"theme-icon theme-icon-shared-folder"+(-1===i.favoriteNfsShares.indexOf(t)?"":" active")},e],click:function(){D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,Z.push({index:p.$focusItem.index,path:e,type:se.folder.id}),Le("openShare",{server:Z.head.path,folder:e},{},function(){D.runtime.stillWaitNetworkResponse=!1}))},value:{item:e}}}),be.concat(e);if(t===se.upnp.id){if(e=Se(e,"name"),Z.config.stageType===se.upnpServer)return r=e.map(function(e){return{items:[{className:"theme-icon theme-icon-shared-folder"},e.name],click:function(){Z.push({index:p.$focusItem.index,url:e.url,ID:e.ID,parentID:e.parentID}),le.openServer(e.url,function(e,t){e||(Z.config.stageType=se.upnpHost,Ee(Te(t,se.upnp.id),x,{focusIndex:0}))})},value:e}}),be.concat(r);if(Z.config.stageType===se.upnpHost||Z.config.stageType===se.upnpDir)return Ie(s=(r=le.prepareUPnPContent(e)).filter(function(e){return 9!==e.type}).map(function(e){return e.mime=V.idToMedia[e.type].mime,e})),r=r.map(function(e){return{items:[{className:"theme-icon "+(9===e.type?"theme-icon-folder":V.idToMedia[e.type].icon)},{value:e.name,className:"listDirNameField"},{className:"theme-icon"}],value:{name:e.name,type:9===e.type?9:10,item:e},click:function(){9===e.type?(Z.push({index:p.$focusItem.index,ID:e.ID,parentID:e.ParentID}),le.openContext(e.ID,function(e,t){e||(Z.config.stageType=se.upnpDir,Ee(Te(t,se.upnp.id),x,{focusIndex:0}))})):V.idToMedia[e.type].opener?V.idToMedia[e.type].opener(e):oe({title:gettext("Can not open this type of file"),icon:"info"})}}}),be.concat(r)}}return he=n,pe=s,o=Ce(ye),a=o.slice()}function Ee(e,t,i){var n={scroll:e.length<=ue?null:t,size:ue,data:e};i&&Object.keys(i).forEach(function(e){n[e]=i[e]}),t&&(e.length>ue?p.scroller||(p.scroller=1,t.init({realSize:e.length}),t.$node.style.display=""):(p.scroller=0,t.$node.style.display="none")),p.init(n),v.innerHTML=Z.config.type?e.length-1:ze.itemsLength}function De(e,t,i,n){var s=void 0===i.index?0:i.index;n=n||function(){D.runtime.stillWaitNetworkResponse=!1},"getGroups"===e?core.plugins.networkSmb.getGroups(function(e,t){t?(Ee(Te(t,se.network.id,i),x,{focusIndex:s}),n()):oe({title:gettext("Unable to get work groups list"),icon:"alert",type:"warning"}),D.runtime.stillWaitNetworkResponse=!1}):"openShare"===e?(D.runtime.openShareAttempts+=1,ae.umount({path:D.config.mountPathSMB,force:!0}),core.plugins.networkSmb.openShare(t,function(e,i){i||D.activePage!==D.pages.connect?(!i&&1===D.runtime.openShareAttempts||e?oe({title:gettext("Authorization may be required. Specify login and password?"),icon:"info",type:"",buttons:[{value:gettext("Cancel"),click:function(){D.runtime.openShareAttempts=0}},{value:gettext("Ok"),click:function(){c.blur(),ge.sambaAuthorize.show()}}]}):!i&&D.runtime.openShareAttempts>1?oe({title:gettext("Credentials are incorrect"),icon:"alert",type:"warning"}):(D.runtime.openShareAttempts=0,5!==Z.config.currentDeviceType&&Z.push({index:p.$focusItem.index,path:t,type:se.smbShare}),ae.readDir(t.mountPath,function(e,i){e||(Z.push({index:p.$focusItem.index,path:t.mountPath,folder:t.folder}),Z.config.isDisplaySmbShares=!0,Z.config.currentDirFilesCount=i.dirs.length+i.files.length,Ee(Te(i,1),x,{focusIndex:s}),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]))})),n()):n(!0)})):"getShares"===e?core.plugins.networkSmb.getShares(t,function(e,t){D.runtime.stillWaitNetworkResponse=!1,e?(Z.pop(),De.cache||(De.cache={}),De.cache.getShares={},De.cache.getShares.config=i,De.cache.getShares.callback=n,oe({title:gettext("Authorization may be required. Specify login and password?"),icon:"info",type:"",buttons:[{value:gettext("Cancel")},{value:gettext("Ok"),click:function(){c.blur(),ge.authorizeSMBServer.show()}}]})):(-1!==fe.indexOf(t[0].server)&&(i.favSharesPresent=!0,i.index=fe.indexOf(t[0].server)),n(),Ee(Te(t,se.network.id,i),x,{focusIndex:s}))}):core.plugins.networkSmb.getServers(t,function(e,t){if(e)return Z.pop(),void De("getGroups",null,{icon:"theme-icon-workgroup",index:p.$focusItem.index},function(){g.innerText=gettext("work groups"),D.runtime.stillWaitNetworkResponse=!1});Ee(Te(t,se.network.id,i),x,{focusIndex:s}),n()})}function Le(e,t,i,n){var s=void 0===i.index?0:i.index;n=n||function(){D.runtime.stillWaitNetworkResponse=!1},"getServers"===e?core.plugins.networkNfs.getServers(function(e,t){t?(g.innerText=gettext("servers"),Z.config.type=se.nfsServer,d.$node.classList.add("networkView"),Ee(Te(t,se.nfsServer,i),x,{focusIndex:s})):oe({title:gettext("Unable to get servers list"),icon:"alert",type:"warning"}),n()}):"getShares"===e?core.plugins.networkNfs.getShares(t,function(e,o){o?(i.favoriteNfsShares=[],D.storage.network.nfs.forEach(function(e){var n=e.path.split(":");n[0]===t.server&&-1!==o.indexOf(n[1])&&i.favoriteNfsShares.push(o.indexOf(n[1]))}),g.innerText="NFS",Z.config.type=se.nfsShare,Ee(Te(o,se.nfsShare,i),x,{focusIndex:s})):oe({title:gettext("Unable to get folders list"),icon:"alert",type:"warning"}),n()}):"openShare"===e&&(core.plugins.networkNfs.umount(!0),core.plugins.networkNfs.mount({address:t&&t.path?t.path:D.runtime.currentServer.path+":"+Z.head.path},function(e,i){if(!i)return Z.pop(),void n(!0);ae.readDir(D.config.mountPathNFS,function(e,i){e||(Z.push({index:p.$focusItem.index,path:D.config.mountPathNFS,folder:t.folder}),Z.config.isDisplayNfsShare=!0,Z.config.type=se.folder.id,Z.config.currentDirFilesCount=i.dirs.length+i.files.length,Ee(Te(i,1),x,{focusIndex:s}),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]))}),n()}))}function Pe(){var e=D.storage.favoritesStorage;K.hide(),ne.textArea.$body.innerHTML="",ne.textArea.$body.appendChild(U.fragment(ce("div",{className:"title"},gettext("Total")+":"),ce("div",{},String(e.length))))}function Re(e,t,i){var n=ne.textArea,s=e.split(""),o=[];i?(i.nodes.forEach(function(e){o.push([ce("div",{className:"title"},e[0]+":"),ce("div",{},e[1])])}),K.hide()):(o=[[ce("div",{className:"title"},gettext("Elements")+":")],[ce("div",{className:"title"},gettext("Name")+":")],[ce("div",{className:"title"},gettext("Creation date")+":")],[ce("div",{className:"title"},gettext("Size")+":")],[ce("div",{className:"title"},gettext("Free space")+":")],[ce("div",{className:"title"},gettext("File system")+":")],[ce("div",{className:"title"},gettext("Unsaved changes")+":")],[ce("div",{className:"title"},gettext("Address")+":")]],K[+s[4]?"show":"hide"]()),n.$body.innerHTML="",n.$body.appendChild(U.fragment.apply(null,[].concat.apply([],o.reduce(function(e,i,n){return+s[n]&&(i.push(ce("div",{},t[n])),e.push(i)),e},[])))),ne.textArea.show(),ne.textArea.init()}function Fe(){var e=p.$focusItem,t=o[e.index],i={},n=e.index;t.value.isFavorite?(D.storage.favoritesStorage=D.storage.favoritesStorage.filter(function(e){return e.path!==Z.path+t.value.name&&e.path!==t.value.item.path}),t.items[2].value="",t.items[2].className="theme-icon",t.value.isFavorite=!1):(i.type=t.value.type,i.name=t.value.name,t.value.item.subtype===we.playlistStream?i.path=t.value.item.uri:t.value.item.subtype===we.playlistFile?(i.path=t.value.item.path,i.uri=t.value.item.uri):(i.path=Z.path+t.value.name,i.size=t.value.item.size,i.lastModified=t.value.item.lastModified),D.storage.favoritesStorage.push(i),t.items[2].value="",t.items[2].className+=" theme-icon-favorite-active active",t.value.isFavorite=!0),Ee(o.slice(0,n).concat(t,o.slice(n+1)),x,{viewIndex:p.viewIndex}),p.focusIndex(n)}function Oe(){var e,t,i,n=p.$focusItem;if(Z.config.isDisplayNfsShare||Z.config.type===se.nfsShare){for(Z.config.type===se.nfsShare?(i={name:n.data.value.item,path:Z.head.path+":"+n.data.value.item},n.children[0].children[0].classList.add("active")):i={name:D.runtime.currentShare.path,path:D.runtime.currentServer.path+":"+D.runtime.currentShare.path},e=0,t=D.storage.network.nfs.length;e<t;e+=1)if(D.storage.network.nfs[e].path===i.path)return;D.storage.network.nfs.push(i)}else{for(5!==Z.length||n.index?(i=n.data.value.item,n.children[0].children[0].classList.add("active")):(delete(i=D.runtime.currentShare.path).mountPath,i.name=i.folder,delete i.folder),e=0,t=D.storage.network.smb.length;e<t;e+=1)if(JSON.stringify(D.storage.network.smb[e].addresses)===JSON.stringify(i.addresses)&&D.storage.network.smb[e].name===i.name)return;D.storage.network.smb.push(i)}}function Ae(){var e=p.$focusItem,t=e.data.value.details,i=e.data.value.deviceType,n=e.index;i===se.nfsPermanentShare?D.storage.network.nfs=D.storage.network.nfs.filter(function(e){return e.path!==t.path}):D.storage.network.smb=D.storage.network.smb.filter(function(e){return t.address?e.address!==t.address||e.name!==t.name:JSON.stringify(e.addresses)!==JSON.stringify(t.addresses)||e.name!==t.name}),Ee(ze(),x,{focusIndex:ze.itemsLength===n?n-1:n})}function ze(){var e,t,i,s=[],o=D.storage.network.smb,a=D.storage.network.nfs,r=core.plugins.networkNfs.hasNfsNativeSupport;return n={},window.top.stbUPnP&&window.top.stbUPnP.getServerListSync?"off"!==D.environment.UPnPMode&&le.setPageSize(ue):"off"!==D.environment.UPnPMode&&(e="/media/UPnP"),ze.itemsToRenderNames=r?[gettext("Favorites"),"SAMBA","NFS","UPnP"]:[gettext("Favorites"),"SAMBA","UPnP"],"off"===D.environment.UPnPMode&&ze.itemsToRenderNames.pop(),se.favorite.opener=function(){var e=D.storage.favoritesStorage;e=e.map(function(e){var t,i={};for(t in e)i[t]=e[t];return i}),Z.config.type=1,Z.config.isDisplayFavorites=!0,Z.config.entryPointIndex=p.$focusItem.index,Z.config.currentDirFilesCount=D.storage.favoritesStorage.length,g.innerText=gettext("Favorites"),Ee(Te({dirs:e.filter(function(e){return 9===e.type}),files:e.filter(function(e){return e.type>9&&!(e.type=void 0)})},1),x,{focusIndex:0})},se.smb.opener=function(){D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,Z.config.type=se.network.id,De("getGroups",null,{icon:"theme-icon-workgroup"},function(){Z.pop(),Z.push({index:p.$focusItem.index,path:"SAMBA_GROUP"}),d.$node.classList.add("networkView"),Z.config.entryPointIndex=ze.itemsToRenderNames.indexOf("SAMBA"),g.innerText=gettext("work groups")}))},se.nfs.opener=function(){D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,Z.pop(),Z.push({index:Z.config.entryPointIndex=p.$focusItem.index,path:"NFS_SERVER"}),Le("getServers",null,{icon:"theme-icon-server"}))},se.upnp.opener=function(){g.innerText=gettext("UPnP"),Z.config.currentDevice=null,Z.config.entryPointIndex=p.$focusItem.index,Z.config.currentDeviceType=se.upnp.id,Z.config.stageType=se.upnp.id,e?(Z.config.type=1,Z.push({index:p.$focusItem.index,path:e}),ae.readDir(Z.path,function(e,t){e||(Z.config.currentDirFilesCount=t.dirs.length+t.files.length,Ee(Te(t,1),x,{focusIndex:0}))})):(Z.config.type=se.upnp.id,le.openRoot(null,null,function(e,t){e?oe({title:gettext(e.message),icon:"alert",type:"warning"}):(Z.config.stageType=se.upnpServer,Ee(Te(t,se.upnp.id),x,{focusIndex:0}))})),$e([[],[[j.f4,gettext("Search"),ve[q.search]]]]).show()},i=[{items:[{className:"theme-icon theme-icon-favorite-active"},{value:gettext("Favorites"),className:"persistentMainEntries"}],value:{type:1},click:se.favorite.opener},{items:[{className:"theme-icon theme-icon-network"},{value:"SAMBA",className:"persistentMainEntries"}],value:{type:se.network.id},click:se.smb.opener},{items:[{className:"theme-icon theme-icon-network"},{value:"NFS",className:"persistentMainEntries"}],value:{type:se.network.id},click:se.nfs.opener},{items:[{className:"theme-icon theme-icon-upnp"},"UPnP"],value:{type:se.upnp.id},click:se.upnp.opener}],!r&&i.splice(2,1),"off"===D.environment.UPnPMode&&i.pop(),ae.getMountPoints().forEach(function(e){n[e.sn]={},s.push({items:[{className:"theme-icon theme-icon-usb"},e.label||e.vendor||e.model],value:{sizeOverview:ee(e.freeSize)+" / "+ee(e.size),freeSize:e.freeSize,fullSize:e.size,fsType:V.fs[e.fsType],isReadOnly:e.isReadOnly,deviceType:8},click:n[e.sn].opener=function(){Z.push({index:p.$focusItem.index,path:e.mountPath}),Z.config.isDeviceReadOnly=e.isReadOnly,ae.readDir(Z.path,function(t,i){i?(g.innerText=e.label||e.vendor||e.model,Z.config.type=1,Z.config.currentDevice=e,Z.config.entryPointIndex=p.$focusItem.index,Z.config.currentDeviceType=8,Z.config.stageType=8,Z.config.currentDirFilesCount=i.dirs.length+i.files.length,Re("1000100",[Z.config.currentDirFilesCount+"",null,null,null,ee(e.freeSize)+" / "+ee(e.size),null,null]),Ee(Te(i,1),x,{focusIndex:0}),m.types.length&&je(m.types)):(Z.pop(),oe({title:gettext("USB Flash Drive error/unable to open"),icon:"info"}))})}}),ze.itemsToRenderNames.push(e.label||e.vendor||e.model)}),o.forEach(function(e){s.push({items:[{className:"theme-icon theme-icon-shared-folder"},e.displayName||e.name],value:{details:e,deviceType:5},click:function(){D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,Z.config.isDisplaySmbShares=!0,Z.config.type=1,Z.config.currentDevice=e,Z.config.currentDeviceType=5,Z.config.entryPointIndex=p.$focusItem.index,De("openShare",{addresses:e.addresses,folder:e.name,mountPath:D.config.mountPathSMB,login:e.login,password:e.password},{},function(){g.innerText=e.displayName||e.name,D.runtime.stillWaitNetworkResponse=!1}))}}),ze.itemsToRenderNames.push(e.name)}),a.forEach(function(e){var t=e;e.displayName&&(t.displayName=e.displayName),t.server=e.path.replace(/^\D+/,"").replace(/:\/.*$/,""),t.address=e.path,s.push({items:[{className:"theme-icon theme-icon-shared-folder"},e.displayName||e.name],value:{details:t,deviceType:se.nfsPermanentShare},click:function(){D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,Z.config.type=se.folder.id,Z.config.currentDevice=e,Z.config.currentDeviceType=se.nfsPermanentShare,Z.config.entryPointIndex=p.$focusItem.index,Le("openShare",{path:e.path,folder:e.name},{},function(){g.innerText=e.displayName||e.name,ne.footer.init(),D.runtime.stillWaitNetworkResponse=!1}))}}),ze.itemsToRenderNames.push(e.name)}),t=i.concat(s),ze.itemsLength=t.length,ze.itemsToRender=t,ze.currentStdout=t.slice(),t}function Me(){Z.config.type||X.search(ze.itemsToRender,function(e){return"string"==typeof e.items[1]?e.items[1]:e.items[1].value},function(e){ze.currentStdout=e,Ee(ze.currentStdout,x,{focusIndex:0}),S.classList.add("active"),ze.currentStdout.length||Re("0000000",[null,null,null,null,null,null,null]),X.searchRequest||S.classList.remove("active"),v.innerHTML=ze.currentStdout.length,D.runtime.isSearched=!0}),X.searchRequest?D.runtime.isSearched=!0:(D.runtime.isSearched=!1,N.innerText=gettext("Search"),S.classList.remove("active"))}function je(e,t){var i,n,s;o?(i=[a[0]],e.length?(n=(s=a.slice(1).filter(function(t){return-1!==e.indexOf(+t.value.type)||-1!==e.indexOf(+t.value.item.type)})).map(function(e){return e.value.item}),Ee(o=i.concat(s),x,{focusIndex:0}),Ie(n),Z.config.currentDirFilesCount=s.length,Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]),y.previousElementSibling.classList.add("active")):Me()):Z.config.type===se.upnp.id&&y.previousElementSibling.classList.add("active")}function Be(){var e=p.$focusItem,t=o.length,i=e.index;ae[9===e.value.type?"removeDir":"removeFile"](Z.path+p.$focusItem.value.name,function(e,n){!e&&n&&Ee((o.splice(i,1),o),x,{focusIndex:t-1===i?i-1:i}),ge.actions.hide()}),Z.config.currentDirFilesCount-=1}function We(e){var t,i,n,a,r,l,V,te,ie,re,le,de,fe,xe;ve[q.resetFilters]=function(){N.innerText=gettext("Search"),S.classList.remove("active"),i=i.map(function(e){return e.state=!1,e}),m.setData({data:i}),X.searchRequest="",s=void 0,je([]),m.types=[],m.title=[],ze.currentStdout=ze.itemsToRender.slice(),ke(),Z.config.type||Ee(ze.currentStdout,x,{focusIndex:0}),D.runtime.isSearched=!1},ve[q.search]=function(){Y.open({title:gettext("FILE SEARCH"),value:X.searchRequest},function(e){(e.value||D.runtime.isSearched)&&(N.innerText=e.value||gettext("Search"),X.searchRequest=e.value,s=new RegExp(X.searchRequest,"i"),Me())})},ve[q.createFolder]=function(){ge.actions.hide(),c.blur(),ge.createFolder.show(),ge.createFolder.focus(),te.focus(),te.focusIndex(0)},ve[q.deleteFile]=function(){oe({title:gettext("Are you sure you want to delete this item?"),icon:"info",type:"",buttons:[{value:gettext("Cancel")},{value:gettext("Ok"),click:Be}]})},ve[q.pinShare]=Oe,ve[q.renamePinnedShare]=function(){ge.actions.hide(),c.blur(),ge.renameShare.show(),ge.renameShare.focus(),ie.focus(),ie.focusIndex(0)},ve[q.unpinShare]=function(){oe({title:gettext("Are you sure you want to delete this shared folder?"),icon:"info",type:"",buttons:[{value:gettext("Cancel")},{value:gettext("Ok"),click:function(){Ae(),ge.actions.hide(),ne.footer.show()}}]})},ve[q.setFavoritesState]=Fe,ve[q.clearFavorites]=function(){oe({title:gettext("Are you sure you want to clear the list of favorites?"),icon:"info",type:"",buttons:[{value:gettext("Cancel")},{value:gettext("Ok"),click:function(){D.storage.favoritesStorage=[]}}]})},ve[q.clearSmbCache]=function(){core.plugins.networkSmb.clearCache(),D.runtime.stillWaitNetworkResponse||(1===Z.length?De("getGroups",null,{icon:"theme-icon-workgroup"}):2===Z.length?De("getServers",Z.head.path,{icon:"theme-icon-server"}):3===Z.length&&De("getShares",{server:Z.head.path},{icon:"theme-icon-shared-folder"}),D.runtime.stillWaitNetworkResponse=!0)},ve[q.clearNfsCache]=function(){core.plugins.networkNfs.clearCache(),D.runtime.stillWaitNetworkResponse||(Z.config.type===se.nfsServer?Le("getServers",null,{icon:"theme-icon-server"}):Z.config.type===se.nfsShare&&Le("getShares",{server:Z.head.path},{icon:"theme-icon-shared-folder"}),D.runtime.stillWaitNetworkResponse=!0)},Object.keys(q).forEach(function(e){Q[e].click=ve[q[e]]}),i=[{state:!1,title:gettext("Folders"),value:se.folder.id},{state:!1,title:gettext("Video"),value:se.fileVideo.id},{state:!1,title:gettext("Audio"),value:se.fileAudio.id},{state:!1,title:gettext("Images"),value:se.fileImage.id},{state:!1,title:gettext("Text"),value:se.fileText.id},{state:!1,title:gettext("CUE"),value:se.fileCUE.id},{state:!1,title:gettext("Disk images"),value:se.fileISO.id},{state:!1,title:gettext("Playlists"),value:se.filePlaylist.id},{state:!1,title:gettext("Streams"),value:se.fileStream.id}],ne.footer=new M({parent:ne,data:[]}),x=new W({value:0,viewSize:ue,className:"listScroll"}),w=new W({value:0,viewSize:5,className:"filterScroll"}),b=new W({className:"rightInfoPanelScroll"}),ne.textArea=new z({propagate:!0,scroll:b,step:1}),n=new B({value:gettext("create"),className:"buttonCreateRename bottom"}),a=new B({value:gettext("Rename"),className:"buttonCreateRename bottom"}),r=new B({value:gettext("authorize"),className:"buttonAuthorize bottom"}),l=new B({value:gettext("authorize"),className:"buttonAuthorize bottom"}),ge.authorizeSMBServer=new F({title:gettext("authorization"),events:{show:function(){D.runtime.isModalShown=!0,ne.footer.hide(),ge.authorizeSMBServer.focus()},hide:function(){re.loginAttempt=re.passwordAttempt=!1,Ne()}},children:[re=new R({className:"padded",cycle:!0,size:2,focusIndex:0,data:[{items:[T=ce("div",{className:"inputSMBShareLoginField theme-item-editable disabled"},gettext("Login"))],click:function(){Y.open({title:gettext("ENTER LOGIN"),value:re.loginAttempt?T.innerText:""},function(e){T.innerText=e.value||gettext("Login"),re.loginAttempt=!!e.value})}},{items:[E=ce("div",{className:"inputSMBSharePasswdField"},gettext("Password")),{className:"theme-item-editable disabled"}],click:function(){Y.open({title:gettext("ENTER PASSWORD"),value:re.passwordAttempt?E.innerText:"",type:"password"},function(e){e.value=e.value.trim(),re.passwordAttempt=!!e.value,e.value?(E.password=e.value,E.innerText=e.value,E.classList.add("theme-text-password")):(E.classList.remove("theme-text-password"),E.innerText=gettext("Password"))})}}],events:{overflow:function(e){e.direction!==j.down&&e.direction!==j.up||(this.blurItem(this.$focusItem),l.focus())}}}),l]}),ge.sambaAuthorize=new F({title:gettext("authorization"),events:{show:function(){D.runtime.isModalShown=!0,ne.footer.hide(),ge.sambaAuthorize.focus()},hide:function(){V.loginAttempt=V.passwordAttempt=!1,Ne()}},children:[V=new R({className:"padded",cycle:!0,size:2,focusIndex:0,data:[{items:[I=ce("div",{className:"inputSMBShareLoginField theme-item-editable disabled"},gettext("Login"))],click:function(){Y.open({title:gettext("ENTER LOGIN"),value:V.loginAttempt?I.innerText:""},function(e){I.innerText=e.value||gettext("Login"),V.loginAttempt=!!e.value})}},{items:[C=ce("div",{className:"inputSMBSharePasswdField"},gettext("Password")),{className:"theme-item-editable disabled"}],click:function(){Y.open({title:gettext("ENTER PASSWORD"),value:V.passwordAttempt?C.innerText:"",type:"password"},function(e){e.value=e.value.trim(),V.passwordAttempt=!!e.value,e.value?(C.password=e.value,C.innerText=e.value,C.classList.add("theme-text-password")):(C.classList.remove("theme-text-password"),C.innerText=gettext("Password"))})}}],events:{overflow:function(e){e.direction!==j.down&&e.direction!==j.up||(this.blurItem(this.$focusItem),r.focus())}}}),r]}),ge.sort=new F({title:gettext("sorting"),events:{show:function(){ge.sort.focus(),D.runtime.isModalShown=!0}},children:[new O({cycle:!0,focusIndex:0,size:4,events:{"click:item":function(e){var i=e.$item.value;ge.sort.hide(),Ee(Ce(ye=1===i?"NAME":2===i?"DATE":3===i?"TYPE":"SIZE"),x,{focusIndex:0}),t.innerText=e.$item.data.title,c.focus(),h.focus()}},data:[{state:!0,title:gettext("By name"),value:1},{state:!1,title:gettext("By date"),value:2},{state:!1,title:gettext("By type"),value:3},{state:!1,title:gettext("By size"),value:4}]})]}),ge.filter=new F({title:gettext("filtering"),events:{show:function(){ge.filter.focus(),D.runtime.isModalShown=!0,ne.footer.hide()}},children:[m=new A({cycle:!0,focusIndex:0,data:i,scroll:w})]}),ge.actions=new F({title:gettext("actions"),events:{show:function(){D.runtime.isModalShown=!0,ge.actions.focus()},hide:Ne,keydown:function(e){e.code===j.ok&&this.hide()}},children:[f=new R({cycle:!0,focusIndex:0,data:[]})]}),f.render=function(e){this.init({data:e,size:e.length,focusIndex:0})},le=ge.actions.show,ge.actions.show=function(){setTimeout(function(){le.call(ge.actions),c.blur()},40)},ge.createFolder=new F({title:gettext("Create folder"),events:{show:function(){D.runtime.isModalShown=!0,ne.footer.hide()},hide:function(){te.createAttempt=!1,Ne()}},children:[te=new R({className:"padded",size:1,focusIndex:0,data:[{items:[$=ce("div",{className:"inputFolderName theme-item-editable theme-text-disabled"},gettext("New folder"))],click:function(){Y.open({title:gettext("ENTER FOLDER NAME"),value:te.createAttempt?$.innerText:""},function(e){$.innerText=e.value||gettext("New folder"),te.createAttempt=!!e.value})}}],events:{overflow:function(e){e.direction!==j.down&&e.direction!==j.up||(this.blurItem(this.$focusItem),n.focus())}}}),n]}),ge.renameShare=new F({title:gettext("Rename"),events:{show:function(){D.runtime.isModalShown=!0,ne.footer.hide()},hide:function(){ie.renameAttempt=!1,Ne()}},children:[ie=new R({className:"padded",size:1,focusIndex:0,data:[{items:[k=ce("div",{className:"inputShareName theme-item-editable disabled"},gettext("New name"))],click:function(){Y.open({title:gettext("ENTER FOLDER NAME"),value:ie.renameAttempt?k.innerText:""},function(e){k.innerText=e.value||gettext("New name"),ie.renameAttempt=!!e.value})}}],events:{overflow:function(e){e.direction!==j.down&&e.direction!==j.up||(this.blurItem(this.$focusItem),a.focus())}}}),a]}),ne.clock=new _({parent:ne,className:"clock",interval:1e3,render:function(e){var t=new Date,i=t.getHours(),n=t.getMinutes();e.innerText=(i>9?i:"0"+i)+":"+(n>9?n:"0"+n)}}),ne.clock.start(),Object.keys(ge).forEach(function(e){return ne.add(ge[e])}),ne.add(c=new P({panels:[new L({size:1,title:[{value:gettext("menu"),className:"name"}],children:[h=new R({cycle:!0,size:5,focusIndex:0,data:[{items:[S=ce("div",{className:"theme-icon theme-icon-search"}),N=ce("div",{className:"inputSearchField"},gettext("Search"))],click:ve[q.search]},{items:[{className:"theme-icon theme-icon-sort-az"},{value:gettext("By name"),className:"theme-item-more"}],click:function(){!Z.config.type||Z.config.type===se.network.id&&Z.head.type<se.smbShare||(c.blur(),ge.sort.show(),ge.sort.focus())}},{items:[{className:"theme-icon theme-icon-filter"},{value:gettext("All"),className:"theme-item-more"}],click:function(){var e,t;Z.config.type&&Z.config.stageType!==se.upnpServer&&Z.config.stageType!==se.upnpHost&&(Ie(pe.map(function(e){return e.value.item})),e=Object.keys(me),t=i.filter(function(t){return-1!==e.indexOf(String(t.value))}),he.length&&t.unshift(i[0]),t.length&&(m.init({data:t,size:t.length<6?t.length:5,scroll:t.length<6?null:w,focusIndex:0}),c.blur(),ge.filter.show(),ge.filter.focus()))}},{items:[{className:"theme-icon theme-icon-network"},{value:gettext("Mount share"),className:"theme-item-more"}],click:function(){D.route(D.pages.connect)}},{items:[{className:"theme-icon theme-icon-exit"},{value:gettext("Exit")}],click:function(){H.goExit(c)}}]})],events:{focus:function(e){L.prototype.defaultEvents.focus.call(this,e),$e([[j.menu,function(){f.render([Q.resetFilters]),ge.actions.show(),ne.footer.hide()}],[[j.f1,gettext("Reset filters"),ve[q.resetFilters]]]]).show()}}}),d=new L({size:1,title:[{value:gettext("files"),className:"name"},ce("div",{className:"amountContainer"},v=ce("div",{className:"amount"},0))],main:!0,children:!ne.loaded&&[p=new R({cycle:!0,focusIndex:0,size:ue,data:ze(),scroll:x,noData:""})]}),u=new L({size:1,title:[{value:gettext("details"),className:"name"}],children:[]})]})),K.init(u,[p.$body.children[0],d.$node,d.$node]),Re("0000000",[null,null,null,null,null,null,null]),u.add(ne.textArea,b),t=h.$body.children[1].children[0].children[1],y=h.$body.children[2].children[0].children[1],d.$body.appendChild(x.$node),ge.filter.$body.appendChild(w.$node),ze.itemsLength<=ue&&(x.$node.style.display="none"),v.innerHTML=Z.config.type?e.length-1:ze.itemsLength,g=d.title.$body.children[0],m.title=m.title||[],m.types=m.types||[],d.focus(),Pe(),u.addListener("focus",function(){ne.footer.hide()}),d.addListener("focus",function(){var e=p.$focusItem;Z.config.type||!Z.config.type&&e&&e.data&&e.data.value&&(5===e.data.value.deviceType||1===e.data.value.type)?p.emit("focus:item"):ne.footer.hide()}),m.addListener("keydown",function(e){var t;e.code===j.back&&(Array.prototype.forEach.call(m.$body.children,function(e){e.state?(-1===m.types.indexOf(e.data.value)&&m.types.push(e.data.value),-1===m.title.indexOf(e.data.title)&&m.title.push(e.data.title)):e.data&&(-1!==m.types.indexOf(e.data.value)&&m.types.splice(m.types.indexOf(e.data.value),1),-1!==m.title.indexOf(e.data.title)&&m.title.splice(m.title.indexOf(e.data.title),1))}),i=i.map(function(e){return e.state=-1!==m.types.indexOf(e.value),e}),je(m.types),t=m.title.length,y.innerText=t>2?m.title.slice(0,2).join(", ")+", ...":t&&t<3?m.title.slice(0,2).join(", "):ke())}),p.addListener("keydown",function(e){var t=p.$focusItem;if(Z.config.type){if(1===Z.config.type&&5!==Z.config.currentDeviceType&&e.code===j.del){if(Z.config.isDisplayFavorites||!t.data.value||Z.config.isDisplaySmbShares||Z.config.isDeviceReadOnly)return;oe({title:gettext("Are you sure you want to delete this item?"),icon:"info",type:"",buttons:[{value:gettext("Cancel")},{value:gettext("Ok"),click:Be}]})}}else e.code===j.del&&oe({title:gettext("Are you sure you want to delete this item?"),icon:"info",type:"",buttons:[{value:gettext("Cancel")},{value:gettext("Ok"),click:Ae}]})}),fe=core.environment.onFocusDebounceTimeout||400,xe=[],p.addListener("focus:item",function(){var e,t,i,n=p.$focusItem;o&&(clearTimeout(de),(e=o[n.index])&&e.value?de=setTimeout(function(){if(9===e.value.type||10===e.value.type){switch(e.value.item.subtype){case we.playlistFile:Re("01000001",[null,e.value.name,null,null,null,null,null,e.value.item.uri]),xe=[],Z.config.isDisplaySmbShares||(xe=[[],[[j.f3,gettext("Favorites"),ve[q.setFavoritesState]]]]);break;case we.playlistStream:Re("01000001",[null,e.value.name,null,null,null,null,null,e.value.item.path],e.value.item.additionalData?{nodes:e.value.item.additionalData}:null),xe=[[j.menu,function(){f.render([Q.setFavoritesState]),ge.actions.show(),ne.footer.hide()}],[[j.f3,gettext("Favorites"),ve[q.setFavoritesState]]]];break;default:e.value.item.type===se.fileCUE.id?(t=e.value.item,i=t.path||Z.path+t.name,ae.readFile(i,function(e,i){var n=J.parseCue(i),s=[[ce("div",{className:"title"},gettext("Name")+":"),ce("div",{},t.name)],[ce("div",{className:"title"},gettext("Creation date")+":"),ce("div",{},new Date(t.lastModified).toLocaleDateString())],[ce("div",{className:"title"},gettext("Size")+":"),ce("div",{},ee(t.size))],[ce("div",{className:"title"},gettext("Album name")+":"),ce("div",{},n.title)],[ce("div",{className:"title"},gettext("Performer")+":"),ce("div",{},n.performer)],[ce("div",{className:"title"},gettext("Genre")+":"),ce("div",{},n.genre)],[ce("div",{className:"title"},gettext("Comment")+":"),ce("div",{},n.comment)],[ce("div",{className:"title"},gettext("Source")+":"),ce("div",{},n.files[0]?n.files[0].name:"")]];s=s.filter(function(e){return e[1].innerText}),ne.textArea.$body.innerHTML="",ne.textArea.$body.appendChild(U.fragment.apply(null,[].concat.apply([],s))),ne.textArea.show(),ne.textArea.init()})):e.value.item.type===se.fileImage.id?G(ne.textArea,"file://"+Z.path+e.value.name,e.value):Re("0111000",[null,e.value.name,new Date(e.value.item.lastModified).toLocaleDateString(),ee(e.value.item.size),null,null,null]),xe=[[],[[j.f3,gettext("Favorites"),ve[q.setFavoritesState]]]],Z.config.isDisplayFavorites||Z.config.isDeviceReadOnly?xe[0]=[j.menu,function(){f.render([Q.setFavoritesState]),ge.actions.show(),ne.footer.hide()}]:(xe[0]=[j.menu,function(){f.render([Q.deleteFile,Q.createFolder,Q.setFavoritesState]),ge.actions.show(),ne.footer.hide()}],xe[1].unshift([j.f1,gettext("Delete"),ve[q.deleteFile]],[j.f2,gettext("Create folder"),ve[q.createFolder]]))}1===Z.config.type||"14"!==e.value.item.type&&!Z.config.isDisplayPlaylist||$e(xe=[[],[[j.f4,gettext("Search"),ve[q.search]]]]),1===Z.config.type&&5!==Z.config.currentDeviceType&&$e(xe)}else Re("0100000",[null,e.value.name,null,null,null,null,null]),1===Z.config.type&&5!==Z.config.currentDeviceType&&(Z.config.isDeviceReadOnly?$e(xe=[[j.menu,function(){f.render([Q.setFavoritesState]),ge.actions.show(),ne.footer.hide()}],[[j.f3,gettext("Favorites"),ve[q.setFavoritesState]]]]).show():$e([[j.menu,function(){f.render([Q.deleteFile,Q.createFolder,Q.setFavoritesState]),ge.actions.show(),ne.footer.hide()}],[[j.f1,gettext("Delete"),ve[q.deleteFile]],[j.f2,gettext("Create folder"),ve[q.createFolder]],[j.f3,gettext("Favorites"),ve[q.setFavoritesState]]]]).show()),5===Z.config.currentDeviceType&&$e(xe=[[],[[j.f4,gettext("Search"),ve[q.search]]]]);var t,i},fe):(5===Z.config.currentDeviceType&&$e(xe=[[],[[j.f4,gettext("Search"),ve[q.search]]]]),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]),5===Z.config.currentDeviceType||Z.config.isDisplayFavorites||Z.head.isDisplayPlaylist||Z.config.isDeviceReadOnly||$e([[j.menu,function(){f.render([Q.createFolder]),ge.actions.show(),ne.footer.hide()}],[[j.f2,gettext("Create folder"),ve[q.createFolder]]]]).show(),Z.config.isDisplayFavorites&&$e([[j.menu,function(){f.render([Q.setFavoritesState]),ge.actions.show(),ne.footer.hide()}],[[j.f3,gettext("Favorites"),ve[q.setFavoritesState]]]]).show(),1===Z.config.type&&Z.config.isDeviceReadOnly&&ne.footer.hide())),Z.config.type===se.network.id&&($e([[j.menu,function(){f.render([Q.clearSmbCache,Q.search]),ge.actions.show(),ne.footer.hide()}],[[j.f1,gettext("Clear cache"),ve[q.clearSmbCache]],[j.f4,gettext("Search"),ve[q.search]]]]).show(),Z.config.type!==se.nfsServer&&Z.config.type!==se.nfsShare||$e([[j.menu,function(){f.render([Q.clearNfsCache,Q.search]),ge.actions.show(),ne.footer.hide()}],[[j.f1,gettext("Clear cache"),ve[q.clearNfsCache]],[j.f4,gettext("Search"),ve[q.search]]]]).show(),(Z.head&&Z.head.type===se.smbServer&&n.index||5===Z.length&&!n.index)&&$e([[j.menu,function(){f.render([Q.pinShare]),ge.actions.show(),ne.footer.hide()}]]).show()),Z.config.type===se.upnp.id&&($e([[j.menu,function(){f.render([Q.search]),ge.actions.show(),ne.footer.hide()}],[[j.f4,gettext("Search"),ve[q.search]]]]).show(),Z.config.stageType!==se.upnpHost&&Z.config.stageType!==se.upnpDir||(clearTimeout(de),de=setTimeout(function(){n.index?(Z.config.stageType===se.upnpDir&&10===n.value.type&&n.value.item.type===se.fileImage.id&&G(ne.textArea,n.value.item.path,{name:n.value.item.name,item:n.value.item}),Re("010"+ +(10===n.value.type)+"000"+ +(10===n.value.type),[null,n.value.name,null,10===n.value.type?ee(n.value.item.size):null,null,null,null,10===n.value.type?n.value.item.path:null])):Re("0000000",[null,null,null,null,null,null,null])},fe))),Z.config.type||(n.data&&n.data.value&&8===n.data.value.deviceType?(ne.footer.hide(),Re("0000110",[null,null,null,null,n.data.value.sizeOverview,n.data.value.fsType+(n.data.value.isReadOnly?" ("+gettext("read-only")+")":""),null]),K.draw({size:n.data.value.fullSize,free:n.data.value.freeSize})):n.data&&n.data.value&&(5===n.data.value.deviceType||n.data.value.deviceType===se.nfsPermanentShare)?(t=n.data.value,i=[[ce("div",{className:"title"},gettext("Display name")+":"),ce("div",{},t.details.displayName||t.details.name)],[ce("div",{className:"title"},gettext("Original name")+":"),ce("div",{},t.details.name)],[ce("div",{className:"title"},gettext("Type")+":"),ce("div",{},t.deviceType===se.nfsPermanentShare?"NFS":"SAMBA")],[ce("div",{className:"title"},gettext("Server")+":"),ce("div",{},t.details.server)],[ce("div",{className:"title"},gettext("Full path")+":"),ce("div",{},t.details.address)]],K.hide(),ne.textArea.$body.innerHTML="",ne.textArea.$body.appendChild(U.fragment.apply(null,[].concat.apply([],i))),ne.textArea.show(),ne.textArea.init(),$e([[j.menu,function(){f.render([Q.unpinShare,Q.renamePinnedShare]),ge.actions.show(),ne.footer.hide()}],[[j.f1,gettext("Delete"),function(){oe({title:gettext("Are you sure you want to delete this shared folder?"),icon:"info",type:"",buttons:[{value:gettext("Cancel")},{value:gettext("Ok"),click:Ae}]})}],[j.f4,gettext("Rename"),ve[q.renamePinnedShare]]]]).show()):n.data&&n.data.value&&1===n.data.value.type?(D.storage.favoritesStorage.length?$e([[j.menu,function(){f.render([Q.clearFavorites]),ge.actions.show(),ne.footer.hide()}],[[j.f1,gettext("Clear"),ve[q.clearFavorites]]]]).show():ne.footer.hide(),Pe()):(ne.footer.hide(),Re("0000000",[null,null,null,null,null,null,null])))}),p.addListener("move:view",function(){p&&p.$focusItem&&p.emit("focus:item")}),n.addListener("click",function(){var e,t=$.innerText.slice(0,255);ae.isFolderExist(e=Z.path+t,function(i,n){n?oe({title:gettext("Folder with this name already exists"),icon:"info"}):ae.createDir(e,function(e,i){!e&&i?(Ee((o.splice(p.$focusItem.index+1,0,{items:[{className:"theme-icon theme-icon-folder"},{value:t,className:"listDirNameField"},{className:"theme-icon"}],value:{name:t,type:9,item:{name:t,type:9}},click:function(){Z.push({index:p.$focusItem.index,path:t}),ae.readDir(Z.path,function(e,t){e||(Z.config.currentDirFilesCount=t.dirs.length+t.files.length,Ee(Te(t,1),null,{focusIndex:0}),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]))})}}),o),x,{focusIndex:p.$focusItem.index+1}),Ne(),$.innerText=gettext("New folder")):oe({title:gettext("Can not set folder name to")+' "'+t+'". '+gettext("Unsupported symbols"),icon:"info"})})})}),n.addListener("keydown",function(e){e.code!==j.up&&e.code!==j.down||(te.focus(),te.focusIndex(0))}),a.addListeners({click:function(){!function(e){for(var t,i=p.$focusItem,n=i.data.value.details,s=i.data.value.deviceType===se.nfsPermanentShare,o=s?D.storage.network.nfs.length:D.storage.network.smb.length;o--;)if(t=D.storage.network[s?"nfs":"smb"][o],JSON.stringify(s?t.path:t.addresses)===JSON.stringify(s?n.path:n.addresses)&&t.name===n.name){D.storage.network[s?"nfs":"smb"][o].displayName=e;break}Ee(ze(),x,{focusIndex:i.index})}(k.innerText),Ne()},keydown:function(e){e.code!==j.up&&e.code!==j.down||(ie.focus(),ie.focusIndex(0))}}),r.addListeners({click:function(){var e=I.innerText,t=C.password,i=p.$focusItem.data,n=i.value.details||i.value.item,s={addresses:n.addresses,folder:n.name,login:e,password:t,mountPath:D.config.mountPathSMB};n.login=e,n.password=t,D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,Ne(),De("openShare",s,{}))},keydown:function(e){e.code===j.up?(V.focus(),V.focusIndex(1)):e.code===j.down&&(V.focus(),V.focusIndex(0))}}),l.addListeners({click:function(){var e=T.innerText,t=E.password,i=p.$focusItem.data.value.item,n={server:i.name,login:e||"",password:t||""};i.login=e,i.password=t,D.runtime.stillWaitNetworkResponse||(D.runtime.stillWaitNetworkResponse=!0,Ne(),De("getShares",n,De.cache.getShares.config,De.cache.getShares.callback))},keydown:function(e){e.code===j.up?(re.focus(),re.focusIndex(1)):e.code===j.down&&(re.focus(),re.focusIndex(0))}}),ae.onMount=function(e){var t;e?Z.config.type||Ee(ze(),x,p.$focusItem?{focusIndex:p.$focusItem.index}:null):Z.config.type?8===Z.config.stageType&&ae.isFolderExist(Z.config.currentDevice.mountPath,function(e,t){var i,n;t||(n=ze(),i=Z.config.entryPointIndex,Z.emit("reset"),ne.footer.hide(),Ee(n,x,{focusIndex:ze.itemsLength===i?i-1:i}))}):(t=p.$focusItem.index,Ee(ze(),x,{focusIndex:t-(ze.itemsLength===t)}))}}function _e(){var e,t,i,n=function(){d.$node.classList.remove("networkView"),Z.config.type=0,o=null,Z.config.currentDeviceType=null,Z.config.isDisplayNfsShare=null,Ee(ze(),null,{focusIndex:Z.config.entryPointIndex}),ne.footer.hide(),g.innerText=gettext("files"),D.runtime.stillWaitNetworkResponse=!1};if(!Z.length&&Z.config.isDisplayFavorites)return Ee(ze.currentStdout,x,{focusIndex:Z.config.entryPointIndex}),Z.emit("reset"),Re("0000000",[null,null,null,null,null,null,null]),p.emit("focus:item"),g.innerText=gettext("files"),void Pe();if(Z.config.type!==se.upnp.id&&(Me.focusToIndex=t=Z.head?Z.head.index:0,Z.pop(),e=Z.length),Z.config.isDisplayPlaylist&&(Z.config.isDisplayPlaylist=!1),Z.config.isDisplayFavorites&&!Z.length)i=D.storage.favoritesStorage,Z.config.currentDirFilesCount=i.length,Ee(Te({dirs:i.filter(function(e){return 9===e.type}),files:i.filter(function(e){return e.type>9})},1),x,{focusIndex:t}),g.innerText=gettext("Favorites");else if(Z.config.currentDeviceType===se.nfsPermanentShare)Z.length?(g.innerText=Z.head.folder||Z.head.path,ae.readDir(Z.path,function(e,i){e||(Z.config.currentDirFilesCount=i.dirs.length+i.files.length,Ee(Te(i,1),x,{focusIndex:t}),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]))}),y.innerText=m.title.length?m.title.join(", "):ke(),je(m.types)):n();else if(Z.config.isDisplayNfsShare)if(3===Z.length){if(D.runtime.stillWaitNetworkResponse)return;D.runtime.stillWaitNetworkResponse=!0,Le("getShares",{server:D.runtime.currentServer.path},{icon:"theme-icon-shared-folder",index:t},function(){Z.config.isDisplayNfsShare=!1,Z.pop(),g.innerText="NFS",D.runtime.stillWaitNetworkResponse=!1})}else g.innerText=Z.head.folder||Z.head.path,ae.readDir(Z.path.split("/").slice(3).join("/"),function(e,i){e||(Z.config.currentDirFilesCount=i.dirs.length+i.files.length,Ee(Te(i,1),x,{focusIndex:t}),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]))}),y.innerText=m.title.length?m.title.join(", "):ke(),je(m.types);else if(Z.config.type===se.network.id&&4===e){if(D.runtime.stillWaitNetworkResponse)return;D.runtime.stillWaitNetworkResponse=!0,o=null,De("getShares",{server:D.runtime.currentServer.path},{icon:"theme-icon-shared-folder",index:t},function(){Re("0000000",[null,null,null,null,null,null,null]),Z.pop(),p.emit("focus:item"),g.innerText="SAMBA",D.runtime.stillWaitNetworkResponse=!1})}else if(Z.config.type===se.network.id&&e>4)5===Z.length&&(g.innerText=Z.head.path.folder),g.innerText=Z.head.folder||Z.head.path,ae.readDir(Z.path,function(e,i){e||(Z.config.currentDirFilesCount=i.dirs.length+i.files.length,Ee(Te(i,1),x,{focusIndex:t}),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]))}),y.innerText=m.title.length?m.title.join(", "):ke(),je(m.types);else if(1===Z.config.type||Z.config.type===se.folder.id)Z.config.isDisplayFavorites&&1===Z.length?ae.readDir(Z.path,function(e,i){e||(Z.config.currentDirFilesCount=i.dirs.length+i.files.length,Ee(Te(i,1),x,{focusIndex:t}),Re("1000000",[Z.config.currentDirFilesCount+"",null,null,null,null,null,null]),g.innerText=Z.head.path.replace(/^.*\//,""))}):e?ae.readDir(Z.path,function(e,i){var n=Z.config.currentDevice;e||(Z.config.currentDirFilesCount=i.dirs.length+i.files.length,1===Z.length?n&&(g.innerText=Z.config.isDisplaySmbShares?n.name:n.label||n.vendor||n.model):g.innerText=Z.head.path,y.innerText=m.title.length?m.title.join(", "):ke(),Ee(Te(i,1),x,{focusIndex:t}),je(m.types))}):(t=Z.config.entryPointIndex,Z.emit("reset"),g.innerText=gettext("files"),ne.footer.hide(),Ee(ze(),x,{focusIndex:t}));else if(Z.config.type===se.network.id&&e<4){if(ne.footer.hide(),D.runtime.stillWaitNetworkResponse)return;D.runtime.stillWaitNetworkResponse=!0,3===Z.length?De("getShares",{server:Z.head.path},{icon:"theme-icon-shared-folder",index:t},function(){Z.config.isDisplaySmbShares=!1,g.innerText="SAMBA",D.runtime.stillWaitNetworkResponse=!1}):2===Z.length?(o=null,De("getServers",Z.head.path,{icon:"theme-icon-server",index:t},function(){g.innerText=gettext("servers"),D.runtime.stillWaitNetworkResponse=!1})):1===Z.length?De("getGroups",null,{icon:"theme-icon-workgroup",index:t},function(){g.innerText=gettext("work groups"),D.runtime.stillWaitNetworkResponse=!1}):n()}else if(Z.config.type===se.upnp.id)Z.config.stageType===se.upnpServer?(Ee(ze(),x,{focusIndex:Z.config.entryPointIndex}),Z.emit("reset"),g.innerText=gettext("files")):Z.config.stageType===se.upnpHost?(t=Z.head.index,le.openRoot(null,null,function(e,i){e?oe({title:gettext(e.message),icon:"alert",type:"warning"}):(Z.config.stageType=se.upnpServer,i.length<t&&(t=0),Ee(Te(i,se.upnp.id),x,{focusIndex:t}),Z.pop())})):Z.config.stageType===se.upnpDir&&(t=Z.head.index,2===Z.length?le.openServer(Z.tail.url,function(e,i){e||(Z.config.stageType=se.upnpHost,i.length<t&&(t=0),Ee(Te(i,se.upnp.id),x,{focusIndex:t}))}):le.openContext(Z.head.parentID,function(e,i){e||(i.length<t&&(t=0),Ee(Te(i,se.upnp.id),x,{focusIndex:t}))}),Z.pop());else if(Z.config.type===se.nfsServer)n();else if(Z.config.type===se.nfsShare){if(D.runtime.stillWaitNetworkResponse)return;D.runtime.stillWaitNetworkResponse=!0,o=null,Le("getServers",Z.head.path,{icon:"theme-icon-server",index:t})}(Z.length||Z.config.type)&&Me()}Z.addListener("reset",function(){o=null,Z.reset()}),se.folder.opener=function(e,t){var i;"dvd"===t.type&&(i=e.path||Z.path,core.intent({action:"play",mime:se.fileVideo.mime,data:{title:e.name,uri:i,solution:"extBDDVD"},events:{}},function(e,t){e||(xe=t)}))},se.fileCUE.opener=function(e){var t=e.path||Z.path+e.name;ae.readFile(t,function(e,i){var n=J.parseCue(i),s=n.files[0].name.replace(/^[^.]+\./,""),o=[];n.files.forEach(function(e){e.tracks.forEach(function(i){var a={name:i.number+". "+i.title,type:"AUDIO"===i.type?6:5,extension:s,time:i.index[i.index.length-1]||0,url:t+"/"+e.name};n.files.length>1&&(a.file=e.name),i.performer!==n.performer&&void 0!==i.performer&&(a.performer=i.performer),o.push(a)})}),Z.push({index:p.$focusItem.index,path:p.$focusItem.data.value.name}),Ee(Te({dirs:[],files:o},1),x,{focusIndex:0})})},se.filePlaylist.opener=function(e){var t=e.path||Z.path+e.name,i=function(e,t){(l=J.parseM3u(t,Z)).items=l.items.filter(function(e){var t;for(t in se)if(se[t].extensions&&-1!==se[t].extensions.indexOf(e.extension||""))return e.type=t.id,e.subtype=e.extension?we.playlistFile:we.playlistStream,!0;return!1}),Z.push({index:p.$focusItem.index,path:p.$focusItem.data.value.name,isDisplayPlaylist:!0}),Z.config.currentDirFilesCount=l.items.length,Ee(Te({dirs:[],files:l.items},1),x,{focusIndex:0})};Z.config.opened=e.name,ie.ajax(t.indexOf("file://")?"file://"+t:t,{onload:i,onerror:function(){ae.readFile(t,i)}})},r=se.fileVideo.opener=se.fileAudio.opener=function(e,t){var i,n,s;e&&(i=e.path?e.path:e.item&&e.item.path?e.item.path:Z.config.type===se.network.id?Z.path+e.name:Z.config.isDisplayNfsShare&&Z.config.currentDeviceType!==se.nfsPermanentShare?Z.path.split("/").slice(3).join("/")+e.name:Z.path+e.name,r.queue=r.queue||me[e.type],s={action:"play",mime:e.mime||se.fileStream.mime,data:{title:e.name,uri:i,solution:e.solution||"auto"},events:{end:function(){if(p.$focusItem.index>=r.queue.length)return n.close(),void(r.queue=null);p.focusIndex(p.$focusItem.index+1),r(p.$focusItem.value,{context:xe})},prev:function(){p.focusIndex(p.$focusItem.index-1),r(Z.config.stageType===se.upnpDir?p.$focusItem.value.item:p.$focusItem.value,{context:xe})},next:function(){p.focusIndex(p.$focusItem.index+1),r(Z.config.stageType===se.upnpDir?p.$focusItem.value.item:p.$focusItem.value,{context:xe})},close:function(){xe=null}}},t&&Object.keys(t).forEach(function(e){s[e]=t[e]}),p.$focusItem.index-he.length==1&&(s.events.prev=null),p.$focusItem.index>=r.queue.length&&(s.events.next=null),n=core.intent(s,function(e,t){e||(xe=t)}))},se.fileStream.opener=function(e){var t,i=se.fileImage.extensions,n=se.fileAudio.extensions,s=se.fileVideo.extensions,o=(e.path.match(/\.[a-z\d]+$/i)||[])[0];(t=e.path.split(" ")).length>1&&(e.solution=t[0],e.path=t[t.length-1]),o?-1!==i.indexOf(o)?e.mime=se.fileImage.mime:-1!==n.indexOf(o)?e.mime=se.fileAudio.mime:-1!==s.indexOf(o)?e.mime=se.fileVideo.mime:e.mime=se.fileStream.mime:e.mime=se.fileStream.mime,r(e)},se.fileImage.opener=function e(t,i){var n,s,o,a,r;t&&(n=t.path||Z.path+t.name,s=me[t.type],n.indexOf("file://")&&n.indexOf("http://")&&n.indexOf("https://")&&(n="file://"+n),r={action:"play",mime:t.mime||se.fileImage.mime,data:{title:t.name,uri:n,totalCount:s.length,currentPosition:s.indexOf(t)+1},events:{end:function(){if(o=s.next,(o=s.next=void 0===o?s.indexOf(t)+1:o+1)===s.length)return a.close(),p.focusIndex(he.length+o+1),void delete s.next;e(s[o],{context:xe})},prev:function(i){o=s.next,i&&i.random&&(o=te(0,s.length-1)),o=0===o||!o&&1===s.length?s.next=s.length-1:s.next=void 0===o?s.indexOf(t)-1:o-1,e(s[o],{context:xe})},next:function(i){o=s.next,i&&i.random&&(o=te(0,s.length-1)),o=o===s.length-1||!o&&1===s.length?s.next=0:s.next=void 0===o?s.indexOf(t)+1:o+1,e(s[o],{context:xe})},close:function(){p.focusIndex(o?he.length+o+1:p.$focusItem.index)}}},i&&Object.keys(i).forEach(function(e){r[e]=i[e]}),a=core.intent(r,function(e,t){e||(xe=t)}))},se.fileISO.opener=function(e){var t,i,n,s,o;e&&(t=e.path||Z.path+e.name,i=me[e.type],o={action:"play",mime:e.mime||se.fileISO.mime,data:{title:e.name,uri:t},events:{end:function(){if(n=i.next,(n=i.next=null==n?i.indexOf(e)+1:n+1)===i.length)return s.close(),p.focusIndex(he.length+n+1),void(i.next=null);r(i[n],{context:xe})},prev:function(){if(0===(n=i.next)||!n&&1===i.length)return s.close(),p.focusIndex(he.length),void(i.next=null);n=i.next=null==n?i.indexOf(e)-1:n-1,r(i[n],{context:xe})},next:function(){if((n=i.next)===i.length-1||!n&&1===i.length)return s.close(),p.focusIndex(he.length+n+1),void(i.next=null);n=i.next=null==n?i.indexOf(e)+1:n+1,r(i[n],{context:xe})},close:function(){p.focusIndex(n?he.length+n+1:p.$focusItem.index)}}},i.indexOf(e)||delete o.events.prev,i.indexOf(e)===i.length-1&&delete o.events.next,s=core.intent(o,function(e,t){e||(xe=t)}))},["connectSMB","connectNFS"].forEach(function(e){D.addListener(e,function(e){!function(e,t,i){var n,s,o,a,r,l,c;function u(){D.runtime.stillWaitNetworkResponse=!1,oe({title:gettext("The folder is already connected"),icon:"alert",type:"warning"})}if(e===se.nfsPermanentShare){if(!t.address||!t.name)return oe({title:gettext("Wrong connection parameters"),icon:"alert",type:"warning"}),void(D.runtime.stillWaitNetworkResponse=!1);for(a={name:t.name,path:t.address+":"+t.name},t.displayName!==t.name&&(a.displayName=t.displayName),l=0,c=D.storage.network.nfs.length;l<c;l+=1)if(D.storage.network.nfs[l].path===a.path)return void u();Le("openShare",{path:a.path},{},function(e){e?i({message:gettext("Unable to connect to the resource with these parameters")}):(i(null),D.storage.network.nfs.push(a),Z.emit("reset"),Z.config.type=se.folder.id,Z.config.currentDevice=a,Z.config.currentDeviceType=se.nfsPermanentShare,Z.config.entryPointIndex=ze.itemsLength,g.innerText=a.displayName||a.name,d.focus())})}else{if(!t.address||!t.name)return oe({title:gettext("Wrong connection parameters"),icon:"alert",type:"warning"}),void(D.runtime.stillWaitNetworkResponse=!1);for(s=t.name,o=t.displayName,r={addresses:[(n=(t.address+"/"+s).split("/").filter(Boolean))[0]],folder:s=n[1],mountPath:D.config.mountPathSMB},a={name:r.folder,addresses:r.addresses},t.login&&(a.login=r.login=t.login,a.password=r.password=t.password),o!==s&&(a.displayName=o),l=0,c=D.storage.network.smb.length;l<c;l+=1)if(JSON.stringify(D.storage.network.smb[l].addresses)===JSON.stringify(a.addresses)&&D.storage.network.smb[l].name===a.name)return void u();Z.config.currentDeviceType=5,De("openShare",r,{},function(e){e?(Z.config.currentDeviceType=void 0,i({message:gettext("Unable to connect to the resource with these parameters")})):(i(null),D.storage.network.smb.push(a),Z.config.isDisplaySmbShares=!0,Z.config.type=1,Z.config.currentDevice=a,Z.config.entryPointIndex=ze.itemsLength,g.innerText=a.displayName||a.name,d.focus())})}}(e.shareType,e.info,e.callback)})}),ne.addListeners({show:function(){ne.loaded||(re.load(function(e,t){t&&(Array.isArray(t.favoritesStorage)&&(D.storage.favoritesStorage=t.favoritesStorage),Array.isArray(t.sharesStorage)?D.storage.network.smb=t.sharesStorage:t.network&&(Array.isArray(t.network.smb)&&(D.storage.network.smb=t.network.smb),Array.isArray(t.network.nfs)&&(D.storage.network.nfs=t.network.nfs)),D.storage.network.smb.length&&D.storage.network.smb.forEach(function(e){fe.push(e.server)}))}),We([]),ne.loaded=!0)},keydown:function(e){e.code===j.back&&(d.$node.classList.contains("active")&&(Z.length||Z.config.isDisplayFavorites||Z.config.type===se.upnp.id)?_e():D.runtime.isModalShown?Ne():(re.saveSync(D.storage),H.goBack()))}}),core.addListeners({intent:function(e,t){"explorer:openResource"===e.action&&(e.data.resource?se[Object.keys(se).filter(function(t){return se[t].id===e.data.resource})].opener():e.data.serialNumber&&n[e.data.serialNumber].opener()),t()},show:function(){ne.loaded&&(de!==D.environment.UPnPMode&&(de=D.environment.UPnPMode,oe({title:gettext("UPnP service status changed to")+": "+("off"===de?gettext("OFF"):de.toUpperCase()),icon:"info"})),Z.config.currentDeviceType===se.upnp.id&&"off"===de?(Z.config.stageType=se.upnpServer,Z.config.entryPointIndex-=1,_e()):Z.config.type||"off"===de==("off"===D.environment.UPnPMode)||Ee(ze(),x,{focusIndex:p.data[p.$focusItem.index+1]?p.$focusItem.index:p.$focusItem.index-1}))},exit:function(){re.saveSync(D.storage)}}),e.exports=ne},function(e,t,i){"use strict";e.exports=i(33),e.exports.prototype.name="stb-component-modal"},function(e,t,i){"use strict";var n=i(2);function s(e){(e=e||{}).$body=document.createElement("div"),e.$body.className="body",n.call(this,e),this.$node.appendChild(document.createElement("div").appendChild(this.$body).parentNode)}s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.name="spa-component-modal",e.exports=s},function(e,t,i){"use strict";var n=i(8),s=i(35),o=0;function a(e){var t=this;this.group="group "+o++,this.$checkedData=null,n.call(this,e),this.addListener("click:item",function(e){var i=e.$item;i.checkBox.set(!0),i.state=i.checkBox.value,i.data.state=i.checkBox.value,t.$checkedData!==i.data&&(t.emit("select",{$last:t.$checkedData,$curr:i}),t.$checkedData&&(t.$checkedData.state=!1),t.$checkedData=i.data)})}a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.name="mag-component-radio-list",a.prototype.group=0,a.prototype.renderItemDefault=function(e,t){var i=document.createElement("table"),n=document.createElement("tr"),o=document.createElement("td"),a=new s({group:this.group});e.innerHTML="",t.state&&(a.set(!0),this.$checkedData=t),i.appendChild(n),o.appendChild(a.$node),o.className="checkBoxWrapper",n.appendChild(o),(o=document.createElement("td")).className="title",o.innerText=t.title||"",n.appendChild(o),e.checkBox=a,e.state=a.value,e.value=t.value,e.appendChild(i)},a.prototype.renderItem=a.prototype.renderItemDefault,e.exports=a},function(e,t,i){"use strict";var n=i(2),s=i(6),o={};function a(e){e=e||{},this.value=!!e.value,this.value&&(e.className+=" checked"),this.group=null,e.group&&(e.className+=" grouped",this.group=e.group,void 0===o[e.group]?o[e.group]=[this]:o[e.group].push(this)),n.call(this,e)}a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.name="spa-component-checkbox",a.prototype.defaultEvents={click:function(){this.set(!this.value)},keydown:function(e){e.code===s.enter&&this.set(!this.value)}},a.prototype.set=function(e){var t,i;if(this.value!==e){if(!this.value&&null!==this.group)for(t=0,i=o[this.group].length;t<i;t++)o[this.group][t].set(!1);return this.value=!this.value,this.$node.classList.toggle("checked"),this.events["change"]&&this.emit("change",{value:this.value}),!0}return!1},e.exports=a},function(e,t,i){"use strict";var n=i(8),s=i(0),o="theme-icon theme-icon-checkbox",a="theme-icon theme-icon-checkbox-active";function r(e){this.checkedData=[],e.classIcon&&(o=e.classIcon),e.classIconActive&&(a=e.classIconActive),e.classChecked&&(o=e.classChecked),n.call(this,e)}r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.name="mag-component-check-list",r.prototype.setData=function(e){var t=0;for(n.prototype.setData.call(this,e),this.checkedData=[];t<this.data.length;t++)this.data[t].defaultState=this.data[t].state,this.data[t].state&&this.checkedData.push(this.data[t]);this.$focusItem?this.defaultFocusIndex=this.$focusItem.index:this.defaultFocusIndex=0},r.prototype.resetData=function(){for(var e=0;e<this.data.length;e++)this.data[e].state=this.data[e].defaultState;this.setData({data:this.data,focusIndex:this.defaultFocusIndex})},r.prototype.clearChecked=function(e){for(var t=0;t<this.data.length;t++)this.data[t].state=!1;e||0===e||(e=this.$focusItem?this.$focusItem.index:0),this.setData({data:this.data,focusIndex:e})},r.prototype.defaultEvents={mousewheel:n.prototype.defaultEvents.mousewheel,keydown:function(e){switch(e.code){case s.up:case s.down:case s.right:case s.left:case s.pageUp:case s.pageDown:case s.home:case s.end:e.stop=!0,this.move(e.code);break;case s.enter:this.changeState(this.$focusItem),this.events["click:item"]&&this.$focusItem&&this.emit("click:item",{$item:this.$focusItem,event:e})}}},r.prototype.changeState=function(e){var t=!e.state,i=this.data[e.index],n=-1;e.state=t,i.state=t,t?(e.classList.add("checked"),e.checkBox.className=a):(e.classList.remove("checked"),e.checkBox.className=o),t?this.checkedData.push(i):-1!==(n=this.checkedData.indexOf(i))&&this.checkedData.splice(n,1),this.events["change:item"]&&this.emit("change:item",{$item:e,state:t})},r.prototype.renderItemDefault=function(e,t){var i,n,s,r;t.className&&(e.className="item "+t.className,e===this.$focusItem&&(e.className+=" focus")),e.ready?(e.$title.innerText=t.title||"",t.state?(e.classList.add("checked"),e.checkBox.className=a):(e.classList.remove("checked"),e.checkBox.className=o),e.state=t.state,e.value=t.value):(e.innerHTML="",i=document.createElement("table"),n=document.createElement("tr"),s=document.createElement("td"),r=document.createElement("div"),t.state?(e.classList.add("checked"),r.className=a):(e.classList.remove("checked"),r.className=o),i.appendChild(n),s.appendChild(r),s.className="checkBoxWrapper",n.appendChild(s),(s=document.createElement("td")).className="title",s.innerText=t.title||"",n.appendChild(s),e.checkBox=r,e.state=t.state,e.value=t.value,e.$title=s,e.appendChild(i),e.ready=!0)},r.prototype.renderItem=r.prototype.renderItemDefault,e.exports=r},function(e,t,i){"use strict";var n=i(2),s=i(0);function o(e){(e=e||{}).$body=document.createElement("div"),e.$body.className="body",this.step=5,this.realHeight=0,this.viewHeight=0,this.topPosition=0,this.scroll=null,n.call(this,e),this.$node.appendChild(this.$body),this.init(e)}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.name="mag-component-scroll-area",o.prototype.defaultEvents={keydown:function(e){switch(e.code){case s.up:case s.down:this.move(e.code)}},mousewheel:function(e){this.move(e.wheelDeltaY>0?s.up:s.down)}},o.prototype.move=function(e){var t=screen.height,i=this.viewHeight-this.realHeight;if(i<0)switch(e){case s.down:if(this.topPosition-this.step*t/100<i)return this.scroll.scrollTo(-i),this.$body.style.top=i+"px",void this.emit("overflow",{direction:e});this.topPosition-=Math.ceil(this.step*t/100),this.scroll&&this.scroll.scrollTo(-this.topPosition),this.$body.style.top=this.topPosition+"px";break;case s.up:if(this.topPosition+this.step*t/100>0)return this.scroll.scrollTo(0),this.$body.style.top="0px",void this.emit("overflow",{direction:e});this.topPosition+=Math.ceil(this.step*t/100),this.scroll&&this.scroll.scrollTo(-this.topPosition),this.$body.style.top=this.topPosition+"px"}else this.emit("overflow",{direction:e})},o.prototype.init=function(e){e=e||{},this.realHeight=this.$body.offsetHeight,this.viewHeight=this.$node.offsetHeight,this.topPosition=0,this.$body.style.top=this.topPosition+"px",e.scroll&&(this.scroll=e.scroll),e.step&&(this.step=e.step),this.scroll&&this.scroll.init({realSize:this.realHeight,viewSize:this.viewHeight,value:this.topPosition})},e.exports=o},function(e,t,i){"use strict";var n=i(1),s=i(0),o={};function a(e){var t=0,i=this;(e=e||{}).focusable=!1,e.visible=e.visible||!1,e.$body=document.createElement("div"),e.$body.className="body",n.call(this,e),this.tabs=[{codes:{}},{codes:{}},{codes:{}},{codes:{}}],this.tab=0,this.$table=this.$node.appendChild(document.createElement("table")),this.$table.insertRow(),this.$table.rows[0].insertCell(-1),this.$left=this.$table.rows[0].cells[0].appendChild(document.createElement("div")),this.$left.className="theme-icon",this.$table.rows[0].insertCell(-1),this.$table.rows[0].cells[1].className="central",this.tabs[t].$body=this.$table.rows[0].cells[1].appendChild(document.createElement("div")),this.tabs[t].$body.className="wrapper hidden",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",++t,this.tabs[t].$body=this.$table.rows[0].cells[1].appendChild(document.createElement("div")),this.tabs[t].$body.className="wrapper hidden",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",++t,this.tabs[t].$body=this.$table.rows[0].cells[1].appendChild(document.createElement("div")),this.tabs[t].$body.className="wrapper hidden",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",++t,this.tabs[t].$body=this.$table.rows[0].cells[1].appendChild(document.createElement("div")),this.tabs[t].$body.className="wrapper hidden",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",this.tabs[t].$body.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.className="button",this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.appendChild(document.createElement("div")),this.tabs[t].$body.lastChild.lastChild.className="title",this.$table.rows[0].insertCell(-1),this.$right=this.$table.rows[0].cells[2].appendChild(document.createElement("div")),this.$right.className="theme-icon",this.init(e.data),this.parent.addListener("keydown",function(e){var t=i.tabs[i.tab];i.visible&&t.codes[e.code]&&"function"==typeof t.codes[e.code].action&&t.codes[e.code].action()})}o[s.f1]="theme-icon-rc-f1",o[s.f2]="theme-icon-rc-f2",o[s.f3]="theme-icon-rc-f3",o[s.f4]="theme-icon-rc-f4",o[s.menu]="theme-icon-rc-menu",o[s.ok]="theme-icon-rc-ok",o[s.info]="theme-icon-rc-info",o[s.playPause]="theme-icon-rc-play-pause",o[s.back]="theme-icon-rc-back",o[s.exit]="theme-icon-rc-home",o[s.keyboard]="theme-icon-rc-vk",o[s.refresh]="theme-icon-rc-refresh",o[s.frame]="theme-icon-rc-aspect",a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.name="mag-component-footer",a.prototype.init=function(e){var t,i,n;function s(t){return function(){"function"==typeof e.middle[t].action&&e.middle[t].action()}}if(e=e||{},this.tabs[this.tab].$body.classList.add("hidden"),this.tab=e.middle&&e.middle.length?e.middle.length-1:0,(i=this.tabs[this.tab]).codes={},e.left?(this.$left.className=e.left.className||"theme-icon "+(o[e.left.code]||"theme-icon-warning"),e.left.disabled?this.$left.classList.add("disabled"):(i.codes[e.left.code]={action:e.left.action},this.$left.style.visibility="inherit",this.$left.onclick=function(){"function"==typeof e.left.action&&e.left.action()})):"hidden"!==this.$left.style.visibility&&(this.$left.style.visibility="hidden"),e.right?(this.$right.className=e.right.className||"theme-icon "+(o[e.right.code]||"theme-icon-warning"),e.right.disabled?this.$right.classList.add("disabled"):(i.codes[e.right.code]={action:e.right.action},this.$right.style.visibility="inherit",this.$right.onclick=function(){"function"==typeof e.right.action&&e.right.action()})):"hidden"!==this.$right.style.visibility&&(this.$right.style.visibility="hidden"),e.middle&&e.middle.length){for(t=0;t<e.middle.length;t++)i.codes[e.middle[t].code]={action:e.middle[t].action},e.middle[t].disabled?i.$body.children[t].classList.add("disabled"):(i.$body.children[t].classList.remove("disabled"),i.$body.children[t].onclick=s(t)),(n=i.$body.children[t].children)[0].className="iconImg "+(e.middle[t].className||"theme-icon "+(o[e.middle[t].code]||"theme-icon-warning")),n[1].innerText=e.middle[t].title||"";i.$body.classList.remove("hidden")}},e.exports=a},function(e,t,i){"use strict";var n=i(2),s=i(6);function o(e){e=e||{},n.call(this,e),e.icon&&(this.$icon=this.$body.appendChild(document.createElement("div")),this.$icon.className="icon "+e.icon),this.$text=this.$body.appendChild(document.createElement("div")),this.$text.classList.add("text"),e.value&&(this.$text.innerText=e.value)}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.name="spa-component-button",o.prototype.clickDuration=200,o.prototype.defaultEvents={click:function(){var e=this;this.$node.classList.add("click"),setTimeout(function(){e.$node.classList.remove("click")},this.clickDuration)},keydown:function(e){e.code===s.enter&&this.events["click"]&&this.emit("click",{event:e})}},e.exports=o},function(e,t,i){"use strict";e.exports=i(41),e.exports.prototype.name="stb-component-scrollbar"},function(e,t,i){"use strict";var n=i(2);function s(e){e=e||{},this.viewSize=10,this.realSize=100,this.value=0,this.type=this.TYPE_VERTICAL,this.thumbRect=null,this.trackRect=null,e.focusable=e.focusable||!1,e.type&&(this.type=e.type),this.type===this.TYPE_HORIZONTAL&&(e.className+=" horizontal"),n.call(this,e),this.$thumb=this.$body.appendChild(document.createElement("div")),this.$thumb.className="thumb",this.init(e)}s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.name="spa-component-scrollbar",s.prototype.TYPE_VERTICAL=1,s.prototype.TYPE_HORIZONTAL=2,s.prototype.init=function(e){void 0!==(e=e||{}).realSize&&(this.realSize=e.realSize),void 0!==e.viewSize&&(this.viewSize=e.viewSize),this.viewSize>=this.realSize?this.$thumb.classList.add("hidden"):this.$thumb.classList.remove("hidden"),void 0!==e.value&&this.scrollTo(e.value),this.type===this.TYPE_VERTICAL?this.$thumb.style.height=this.viewSize/this.realSize*100+"%":this.$thumb.style.width=this.viewSize/this.realSize*100+"%",this.thumbRect=this.$thumb.getBoundingClientRect(),this.trackRect=this.$node.getBoundingClientRect()},s.prototype.scrollTo=function(e){return this.value!==e&&(0!==this.thumbRect.height&&0!==this.thumbRect.width||(this.trackRect=this.$node.getBoundingClientRect(),this.thumbRect=this.$thumb.getBoundingClientRect()),this.type===this.TYPE_VERTICAL?this.$thumb.style.marginTop=(this.trackRect.height-this.thumbRect.height)*e/(this.realSize-this.viewSize)+"px":this.$thumb.style.marginLeft=(this.trackRect.width-this.thumbRect.width)*e/(this.realSize-this.viewSize)+"px",this.events["change"]&&this.emit("change",{curr:e,prev:this.value}),e>=this.realSize&&(e=this.realSize,this.events["done"]&&this.emit("done")),this.value=e,!0)},e.exports=s},function(e,t,i){"use strict";var n=i(1);function s(e){var t;e=e||{},this.timerId=0,e.render&&(this.render=e.render),e.focusable=!1,e.visible=e.visible||!0,this.value=e.value,this.active=!1,Object.defineProperty(this,"interval",{set:function(e){t=e},get:function(){return t}}),this.interval=e.interval||1e3,n.call(this,e)}s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.name="spa-component-flicker",s.prototype.start=function(){var e=this;this.active||(this.active=!0,function t(){e.render(e.$node,e.value),e.timerId=setTimeout(t,e.interval)}())},s.prototype.stop=function(){this.active&&(this.active=!1,clearTimeout(this.timerId))},s.prototype.defaultRender=function(e,t){e.innerText=t},s.prototype.render=s.prototype.defaultRender,e.exports=s},function(e,t,i){"use strict";var n=i(4);t.goBack=function(){core.call("stop")},t.goHome=function(){},t.goExit=function(e,t){var s,o=i(9),a=i(7),r=i(0),l=n.activePage.activeComponent;n.activePage.add(s=new o({title:gettext("Exit"),events:{show:function(){e.blur(),this.children[0].focus()},hide:function(){l.focus()}},children:[new a({className:"padded",size:2,focusIndex:0,data:[{items:[{value:gettext("Yes")}],click:function(){if("function"==typeof t&&t(!0))return s.hide(),void s.remove();s.hide(),s.remove(),core.call("exit")}},{items:[{value:gettext("No")}],click:function(){"function"==typeof t&&t(!1),s.hide(),s.remove(),e.focus()}}],events:{keydown:function(i){a.prototype.defaultEvents.keydown.call(this,i),i.code===r.back&&(i.stop=!0,"function"==typeof t&&t(!1),s.hide(),s.remove(),e.focus())}}})]})),s.show(),s.focus()}},function(e,t,i){"use strict";e.exports={resetFilters:0,search:1,createFolder:2,deleteFile:3,pinShare:4,renamePinnedShare:5,unpinShare:6,setFavoritesState:7,clearFavorites:8,clearSmbCache:9,clearNfsCache:10}},function(e,t,i){"use strict";var n=i(16),s=n.tag;e.exports=function(e,t,o){var a=new Image;a.onload=function(){e.$body.innerHTML="",e.$body.appendChild(n.fragment.apply(null,[s("div",{className:"imagePreviewContainer"},this),s("div",{className:"title"},gettext("Name")+":"),s("div",{},o.name),o.item.Creator?s("div",{className:"title"},gettext("Creator")+":"):s("div",{className:"title"},gettext("Date")+":"),o.item.Creator?s("div",{},o.item.Creator):s("div",{},new Date(o.item.last_modified).toLocaleDateString()),s("div",{className:"title"},gettext("Resolution")+":"),s("div",{},this.width+"x"+this.height),s("div",{className:"title"},gettext("Size")+":"),s("div",{},i(18)(o.item.size).singleObject)])),e.show(),e.init()},a.onerror=function(e){},a.src=t}},function(e,t,i){"use strict";t.getFileNameComponents=function(e){var t=e.match(/^([\S\s]+)\.([^.]+)$/);return{name:t?t[1]:"",extension:t?t[2]:""}},t.parseCue=function(e){var t=null,i=null,n={files:[]};return e.split("\n").forEach(function(e){var s,o,a,r,l,c;switch(o=(s=(e=e.trim()).split(" ")).shift().toLowerCase(),a=e.slice(o.length).trim(),o){case"title":case"performer":case"songwriter":'"'===a.charAt(0)&&'"'===a.charAt(a.length-1)&&(a=a.slice(1,a.length-1)),i?i[o]=a:n[o]=a;break;case"file":t={tracks:[]},(r=a.split(" ")).length>1&&'"'!==a.charAt(a.length-1)&&(t.type=r.pop(),a=a.slice(0,-t.type.length).trim()),'"'===a.charAt(0)&&'"'===a.charAt(a.length-1)&&(a=a.slice(1,a.length-1)),t.name=a,n.files.push(t);break;case"track":i={number:s[0],type:s[1],index:[]},t.tracks.push(i);break;case"rem":-1!==["GENRE","DATE","COMMENT","PLACE"].indexOf(s[0])&&(a=a.slice(s[0].length).trim(),l=s[0].toLowerCase(),'"'===a.charAt(0)&&'"'===a.charAt(a.length-1)&&(a=a.slice(1,a.length-1)),null===i?n[l]=a:i[l]=a);break;case"index":null!==i&&(c=(s[1]||"00:00:00").split(":"),i.index.push(60*parseInt(c[0],10)+parseInt(c[1],10)))}}),n},t.parseM3u=function(e,t){var i,n=e.trim().split("\n"),s={},o={strict:!1,config:{},items:[]};return(n=(n=n.map(Function.prototype.call,String.prototype.trim)).filter(Boolean)).length>0&&("#EXTM3U"===n[0]&&(o.strict=!0,n.shift()),n.forEach(function(e){var n,a,r,l;if("#"===e.charAt(0))switch(e.substr(1,6).toUpperCase()){case"EXTCFG":(a=(n=e.substr(7).trim()).indexOf("="))>0&&(r=n.substr(0,a).trim(),l=n.substr(a+1).trim(),r&&l&&(1===(r=r.split(".")).length?o.config[r[0]]=l:("object"!=typeof o.config[r[0]]&&(o.config[r[0]]={}),o.config[r[0]][r[1]]=l)));break;case"EXTINF":(a=(n=e.substr(8).trim()).indexOf(","))>0&&(s.time=n.match(/^-?\d+/)[0],s.name=n.substr(a+1).trim(),(i=(i=n.substr(0,a).trim()).replace(/^-?\d+/,"").trim())&&(i=i.split(" ").map(function(e){return(e=e.split("="))[1]=e[1].slice(1,-1),e}),s.additionalData=i))}else s.uri=e,-1===e.indexOf("://")?(e=e.replace(/\\/g,"/"),s.extension=e.split(".").pop().toLowerCase(),s.path=t.path+e):s.path=e,s.name=s.name||s.uri,o.items.push(s),s={}}),o.config&&["VM_IPTV_ENABLED","VM_OTT_ENABLED","VM_OTT_LOG_ENABLED"].forEach(function(e){o.config[e]&&(o.config[e]=-1!==["true","yes","1"].indexOf(o.config[e].toLowerCase()))})),o}},function(e,t,i){"use strict";var n,s,o=1,a={mode:o,matchCase:!1},r=(s={},function(e){return s[e]||(s[e]=new RegExp(e,a.matchCase?"":"i")),s[e]}),l={};l[o]=function(e){return r(n).test(e)},e.exports={get searchRequest(){return n},set searchRequest(e){n=e},modeSubString:o,modeFuzzy:2,modeWildCard:3,setup:function(e){a.mode=e.mode||o,a.matchCase=e.matchCase||!1},search:function(e,t,i){var n=l[a.mode],s=e.filter(function(e){return n(t(e))});if(!i)return s;i(s)}}},function(e,t,i){"use strict";var n=i(5),s=i(10).media,o=new n,a=[];o.pop=function(){return a.pop()},o.push=function(){return a.push.apply(a,arguments)},o.reset=function(){a.length=0,this.config={type:s.init.id}},Object.defineProperties(o,{path:{get:function(){var e;return this.config.type===s.network.id&&(e=a.slice(4)),(e||a).reduce(function(e,t){return e+t.path+"/"},"")}},head:{get:function(){return a[a.length-1]}},tail:{get:function(){return a[0]}},length:{get:function(){return a.length}}}),o.reset(),e.exports=o},function(e,t,i){"use strict";var n,s,o,a,r={},l=!1;e.exports={init:function(e,t){n=e,s=function(e){var t="string"==typeof e[0]?e[0]:getComputedStyle(e[0]).backgroundColor,i="string"==typeof e[1]?e[1]:getComputedStyle(e[1]).backgroundColor,n="string"==typeof e[2]?e[2]:getComputedStyle(e[2]).color;return{inUseSpace:t,freeSpace:i=i.replace(/(?:0\.)?\d+/g,function(e){return Math.floor(1.2*e)}),text:n}}(t)},draw:function(e){var t,i,c,d,u,h,p,f,m,v,g,y,x;if(e.size!==r.fullSize||e.free!==r.freeSize){for(t=document.createElement("div"),i=document.createElement("canvas"),c=t.cloneNode(!1),m=i.getContext("2d"),v=[e.size-e.free,e.free],g=0,y=0,r.fullSize=e.size,r.freeSize=e.free,l||(p=t.cloneNode(!1),f=t.cloneNode(!1),d=t.cloneNode(!1),u=document.createTextNode(gettext("In use")),h=document.createTextNode(gettext("Free")),d.className="indicatorsBlock",f.className="allocatedSpaceMark",p.className="freeSpaceMark",f.style.backgroundColor=s.inUseSpace,p.style.backgroundColor=s.freeSpace,d.appendChild(f),d.appendChild(u),d.appendChild(p),d.appendChild(h),n.$body.children[0].appendChild(d),l=!0),a&&(t.parentNode.removeChild(a),a=null),t.className="infoStorageDiagram",c.innerText=Math.floor(100*(e.size-e.free)/e.size)+"%",c.style.color=s.text,t.appendChild(i),t.appendChild(c),n.$body.children[0].appendChild(t),x=0;x<v.length;x+=1)y+=v[x];for(i.width=i.height=n.$node.offsetHeight/2.55,x=0;x<v.length;x+=1)m.fillStyle=[s.inUseSpace,s.freeSpace][x],m.beginPath(),m.moveTo(i.width/2,i.height/2),m.arc(i.width/2,i.height/2,i.height/2,g,g+2*Math.PI*(v[x]/y),!1),m.lineTo(i.width/2,i.height/2),m.fill(),g+=2*Math.PI*(v[x]/y);a=t,o=d}},show:function(){l&&(a.classList.remove("hidden"),o.classList.remove("hidden"))},hide:function(){l&&(a.classList.add("hidden"),o.classList.add("hidden"))}}},function(e,t,i){"use strict";e.exports={resetFilters:{items:[{className:"theme-icon theme-icon-rc-f1"},gettext("Reset filters")]},search:{items:[{className:"theme-icon theme-icon-rc-f4"},gettext("Search")]},createFolder:{items:[{className:"theme-icon theme-icon-rc-f2"},gettext("Create folder")]},deleteFile:{items:[{className:"theme-icon theme-icon-rc-f1"},gettext("Delete")]},pinShare:{items:[{className:"theme-icon theme-icon-shortcut"},gettext("Create shortcut")]},renamePinnedShare:{items:[{className:"theme-icon theme-icon-rc-f4"},gettext("Rename")]},unpinShare:{items:[{className:"theme-icon theme-icon-rc-f1"},gettext("Delete")]},setFavoritesState:{items:[{className:"theme-icon theme-icon-rc-f3"},gettext("Favorites")]},clearFavorites:{items:[{className:"theme-icon theme-icon-rc-f1"},gettext("Clear")]},clearSmbCache:{items:[{className:"theme-icon theme-icon-rc-f1"},gettext("Clear cache")]},clearNfsCache:{items:[{className:"theme-icon theme-icon-rc-f1"},gettext("Clear cache")]}}},function(e,t,i){"use strict";e.exports=function(e,t){return Math.floor(Math.random()*(t-e+1))+e}},function(e,t,i){"use strict";var n={},s={method:"GET",async:!0,headers:{},type:"text",data:null,timeout:3e4,onload:null,onerror:null,ontimeout:null},o=Object.keys(s);n.ajax=function(e,t){var i,n,a;if(t=t||{},e&&("string"==typeof e||e instanceof String)&&e.length>0){if(t&&"object"==typeof t)for(i=0;i<o.length;i++)void 0===t[o[i]]&&(t[o[i]]=s[o[i]]);if((a=new XMLHttpRequest).open(t.method,e,t.async),t.headers&&"object"==typeof t.headers)for(n=Object.keys(t.headers),i=0;i<n.length;i++)a.setRequestHeader(n[i],t.headers[n[i]]);return a.responseType=t.type,a.timeout=t.timeout,t.onload&&"function"==typeof t.onload&&(a.onload=function(){t.onload.call(this,this.status,this.response||this.responseText)}),a.onerror=t.onerror,a.ontimeout=t.ontimeout,a.send(t.data?JSON.stringify(t.data):null),a}return!1},e.exports=n},function(e,t,i){"use strict";var n=i(2);function s(e){e=e||{},this.active=!1,this.activeComponent=null,n.call(this,e),this.active=this.$node.classList.contains("active"),null===this.$node.parentNode&&document.body.appendChild(this.$node),this.page=this}s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.name="spa-component-page",e.exports=s},function(e,t,i){"use strict";var n,s,o=i(4),a=i(0),r=i(19),l=i(12),c=i(14),d=i(7),u=i(9),h=i(15),p=i(55),f=i(10).media,m=i(17).open,v=new r({$node:document.getElementById("pageConnect")}),g=f.smb.id,y={server:"",folderServer:"",folderLocal:"",login:"",password:""},x={server:"",folderServer:"",folderLocal:""};v.once("show",function(){var e,t,i,r,b,w,S,N,$,k,I,C;C=new h({value:gettext("Connect"),className:"bottom theme-footer",events:{click:function(){g===f.smb.id?o.emit("connectSMB",{shareType:f.smbPermanentShare.id,info:{address:y.server,name:y.folderServer,displayName:y.folderLocal,login:y.login,password:y.password},callback:function(e){e?core.notify({title:gettext(e.message),icon:"alert",type:"warning"}):o.route(o.pages.main)}}):o.emit("connectNFS",{shareType:f.nfsPermanentShare.id,info:{address:x.server,name:x.folderServer,displayName:x.folderLocal},callback:function(e){e?core.notify({title:gettext(e.message),icon:"alert",type:"warning"}):o.route(o.pages.main)}})},keydown:function(e){e.code===a.up?(I.focus(),I.$focusItem.classList.add("focus"),I.focusIndex(I.data.length-1)):e.code===a.down?(I.focus(),I.$focusItem.classList.add("focus"),I.focusIndex(0)):e.code===a.ok&&C.emit("click",{event:e})}}}),n=new u({parent:v,title:gettext("Connection type"),events:{hide:function(){return s.focus()}},children:[new d({className:"padded",cycle:!0,size:2,focusIndex:0,data:[{items:[{value:"SMB"}],click:function(){g===f.nfs.id&&(I.setData({data:$,focusIndex:I.links.mountType.$parentItem.index}),r.innerText=y.server,b.innerText=y.folderServer,w.innerText=y.folderLocal,g=f.smb.id,this.focusIndex=0),n.hide()}},{items:[{value:"NFS"}],click:function(){g===f.smb.id&&(I.setData({data:k,focusIndex:I.links.mountType.$parentItem.index}),e.innerText=x.server,t.innerText=x.folderServer,i.innerText=x.folderLocal,g=f.nfs.id,this.focusIndex=1),n.hide()}}]})]}),$=[{items:[{value:gettext("Server address")+":",className:"theme-subhead-color"},r=p(),{className:"theme-item-editable disabled"}],click:function(){m({title:gettext("ENTER SERVER ADDRESS"),value:y.server},function(e){r.innerText=y.server=e.value})}},{items:[{value:gettext("Server folder")+":",className:"theme-subhead-color"},b=p(),{className:"theme-item-editable disabled"}],click:function(){m({title:gettext("ENTER SERVER FOLDER NAME"),value:y.folderServer},function(e){b.innerText=y.folderServer=e.value,y.folderLocal||(w.innerText=y.folderLocal=e.value)})}},{items:[{value:gettext("Local folder")+":",className:"theme-subhead-color"},w=p(),{className:"theme-item-editable disabled"}],click:function(){m({title:gettext("ENTER FOLDER NAME"),value:y.folderLocal},function(e){w.innerText=y.folderLocal=e.value||y.folderServer})}},{name:"mountType",items:[{value:gettext("Connection type")+":",className:"theme-subhead-color"},{value:"SMB",className:"mountType"},{className:"theme-item-more"}],click:function(){n.show(),n.focus(),s.blur()}},{items:[{value:gettext("Login")+":",className:"theme-subhead-color"},S=p(),{className:"theme-item-editable disabled"}],click:function(){m({title:gettext("ENTER LOGIN"),value:y.login},function(e){S.innerText=y.login=e.value})}},{items:[{value:gettext("Password")+":",className:"theme-subhead-color"},N=p("theme-text-password"),{className:"theme-item-editable disabled"}],click:function(){m({title:gettext("ENTER PASSWORD"),type:"password",value:y.password},function(e){N.innerText=y.password=e.value})}}],k=[{items:[{value:gettext("Server address")+":",className:"theme-subhead-color"},e=p(),{className:"theme-item-editable disabled"}],click:function(){m({title:gettext("ENTER SERVER ADDRESS"),value:x.server},function(t){e.innerText=x.server=t.value})}},{items:[{value:gettext("Server folder")+":",className:"theme-subhead-color"},t=p(),{className:"theme-item-editable disabled"}],click:function(){m({title:gettext("ENTER SERVER FOLDER NAME"),value:x.folderServer},function(e){t.innerText=x.folderServer=e.value,x.folderLocal||(i.innerText=x.folderLocal=e.value)})}},{items:[{value:gettext("Local folder")+":",className:"theme-subhead-color"},i=p(),{className:"theme-item-editable disabled"}],click:function(){m({title:gettext("ENTER FOLDER NAME"),value:x.folderLocal},function(e){i.innerText=x.folderLocal=e.value||x.folderServer})}},{name:"mountType",items:[{value:gettext("Connection type")+":",className:"theme-subhead-color"},{value:"NFS",className:"mountType"},{className:"theme-item-more"}],click:function(){n.show(),n.focus(),s.blur()}}],v.add(s=new c({panels:[new l({main:!0,title:[{value:gettext("Connect network folder"),className:"name"}],children:[I=new d({className:"mountNetworkFolderList",size:(g===f.smb.id?$:k).length,focusIndex:0,data:g===f.smb.id?$:k,events:{overflow:function(){I.$focusItem.classList.remove("focus"),C.focus()}}}),C]})]})),s.focus()}),v.addListener("keydown",function(e){e.code===a.back&&o.route(o.pages.main)}),e.exports=v},function(e,t,i){"use strict";e.exports=function(e){var t,i,n=document.createElement("div");for(e&&(n.className=e),i=1;i<arguments.length;i+=1)t=arguments[i],n.appendChild(t instanceof Element?t:document.createTextNode(t));return n}}]);
//# sourceMappingURL=main.js.map