module.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function o(){this.events={}}o.prototype={addListener:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},once:function(e,t){var r=this;this.events[e]=this.events[e]||[],this.events[e].push(function o(){r.removeListener(e,o),t.apply(r,arguments)})},addListeners:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.addListener(t,e[t])},removeListener:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(function(e){return e!==t}),0===this.events[e].length&&(this.events[e]=void 0))},emit:function(e){var t,r=this.events[e];if(r)for(t=0;t<r.length;t++)r[t].apply(this,Array.prototype.slice.call(arguments,1))}},o.prototype.constructor=o,e.exports=o},function(e,t,r){"use strict";var o,n=r(0),s=r(2),a=r(4),i={},d=["","Scheduled recording","Recording","Recording error!","Recorded"],c=new n,u=new n;function l(){var e,t=this;n.call(this),this.updateTime=6500,this.records=[],this.hash={},this.timerId=null,this.enabled=!!MODE_STALKER,Object.defineProperties(this,{list:{get:function(){return t.records},set:function(){return!1}},updateInterval:{get:function(){return t.updateTime},set:function(e){t.updateTime=e,clearInterval(t.timerId),t.enabled&&(t.timerId=setInterval(t.update,t.updateTime))}}}),this.update(),this.timerId=setInterval((e=this,function(){e.update()}),t.updateTime)}u.list=[],u.addItem=function(e){!u.list.some(function(t){return t.id===e.id})&&c.api&&(u.list.push(e),i.addItem(e))},u.removeItem=function(e){u.list.some(function(t,r){return t.id===e.id&&(u.list.splice(r,1),!0)})&&c.api&&i.removeItem(e)},l.prototype=Object.create(n.prototype),l.prototype.constructor=l,l.prototype.errorCodes={"-1":"Wrong channel id.","-2":"Server error.","-3":"Wrong server record object.","-4":"Server api not available."},l.prototype.states={WAITING:1,RECORDING:2,ERROR:3,FINISHED:4},l.prototype.errors={WRONG_ID:"-1",SERVER_ERROR:"-2",WRONG_RECORD_OBJECT:"-3",API_NOT_AVAILABLE:"-4"},l.prototype.status={0:1,1:2,2:4},l.prototype.add=function(e,t){var r,o=this;"function"==typeof t&&(e.id?this.enabled?(r={ch_id:e.id},e.startTime&&(r.start_time=e.startTime),e.endTime&&(r.end_time=e.endTime),core.backend.request("recordings",{version:3,method:"POST",body:JSON.stringify(r),onload:function(e,r){var s,a;if(e){try{r=JSON.parse(r).message}catch(e){r=e}t({code:o.errors.SERVER_ERROR,message:r})}else s=r.data,(a=new n).serverData={id:s.id,state:o.states.WAITING,url:"",path:"",channel:s.ch_name,channelId:s.ch_id,name:s.name||s.ch_name+" "+s.id,startTime:s.start_time,endTime:s.end_time,progress:0,server:!0,downloadable:s.downloadable},a.states=o.states,a.stop=function(e){core.backend.request("recordings/"+this.data.id+"/stop",{version:3,method:"PUT",onload:function(t,r){t?e({code:o.errors.SERVER_ERROR,message:o.errorCodes[o.errors.SERVER_ERROR]}):r&&r.data&&!r.error?(o.events["stop"]&&o.emit("stop",{item:this,time:(new Date).getTime()}),e(null,!0)):e({code:o.errors.SERVER_ERROR,message:o.errorCodes[o.errors.SERVER_ERROR]})},onerror:function(){}})},o.hash[a.data.id]=a,o.records.push(a),u.addItem(a.data),o.events["add"]&&o.emit("add",{item:a,time:(new Date).getTime()}),t(null,!0)},onerror:function(){}})):t({code:this.errors.API_NOT_AVAILABLE,message:this.errorCodes[this.errors.API_NOT_AVAILABLE]}):t({code:this.errors.WRONG_ID,message:this.errorCodes[this.errors.WRONG_ID]}))},l.prototype.remove=function(e,t){var r=this;"function"==typeof t&&(this.enabled?e&&e instanceof n?core.backend.request("recordings/"+e.data.id,{version:3,method:"DELETE",onload:function(o,n){if(o){try{n=JSON.parse(n).message}catch(e){n=e}t({code:r.errors.SERVER_ERROR,message:r.errorCodes[r.errors.SERVER_ERROR]})}else n&&n.data&&!n.error?(delete r.hash[e.data.id],u.removeItem(r.records.splice(r.records.indexOf(e),1)[0].data),r.events["remove"]&&r.emit("remove",{item:e,time:(new Date).getTime()}),t(null,!0)):t({code:r.errors.SERVER_ERROR,message:r.errorCodes[r.errors.SERVER_ERROR]})},onerror:function(){}}):t({code:this.errors.WRONG_RECORD_OBJECT,message:this.errorCodes[this.errors.WRONG_RECORD_OBJECT]}):t({code:this.errors.API_NOT_AVAILABLE,message:this.errorCodes[this.errors.API_NOT_AVAILABLE]}))},l.prototype.getFileUrl=function(e,t){var r=this;"function"==typeof t&&(this.enabled?e&&e instanceof n?core.backend.request("recordings/"+e.data.id+"/link",{version:3,method:"GET",onload:function(e,o){if(e){try{o=JSON.parse(o).message}catch(e){o=e}t({code:r.errors.SERVER_ERROR,message:r.errorCodes[r.errors.SERVER_ERROR]})}else o.data&&o.data.url?t(null,{url:o.data.url,mediaId:o.data.media_id}):t({code:r.errors.SERVER_ERROR,message:r.errorCodes[r.errors.SERVER_ERROR]})},onerror:function(){}}):t({code:this.errors.WRONG_RECORD_OBJECT,message:this.errorCodes[this.errors.WRONG_RECORD_OBJECT]}):t({code:this.errors.API_NOT_AVAILABLE,message:this.errorCodes[this.errors.API_NOT_AVAILABLE]}))},l.prototype.reset=function(){this.records=[],this.hash={},this.update()},l.prototype.destroy=function(){this.events={},this.records=[],this.hash={},clearInterval(this.timerId)},l.prototype.update=function(e){var t=this;this.enabled?core.backend.request("recordings",{version:3,method:"GET",onload:function(r,o){var s,a,d,c,l;if(r);else{try{s=o.data}catch(r){s=[]}for(a=0;a<s.length;a++)t.hash[s[a].id]?(d=t.hash[s[a].id],2!==t.status[s[a].status]&&4!==t.status[s[a].status]||(c=(c=(c=Math.ceil(((new Date).getTime()/1e3-s[a].start_time)/(s[a].end_time-s[a].start_time)*100))<0?0:c)>100?100:c)!==d.data.progress&&(d.data.progress=c,t.records[t.records.indexOf(d)].data.progress=c,i.emitProgress(d),t.events["progress"]&&t.emit("progress",{item:d,time:(new Date).getTime()})),t.status[s[a].status]!==d.data.state&&(d.data.state=t.status[s[a].status],d.data.downloadable=s[a].downloadable,t.records[t.records.indexOf(d)].data.state=t.status[s[a].status],t.records[t.records.indexOf(d)].data.downloadable=s[a].downloadable,i.emitChange(d),t.events["state"]&&t.emit("state",{item:d,time:(new Date).getTime()}))):(l=s[a],(d=new n).data={id:l.id,state:t.status[l.status],url:"",path:"",channel:l.ch_name,channelId:l.ch_id,name:l.name||l.ch_name+" "+l.id,startTime:l.start_time,endTime:l.end_time,progress:0,server:!0,downloadable:l.downloadable},c=(c=(c=Math.ceil(((new Date).getTime()/1e3-l.start_time)/(l.end_time-l.start_time)*100))<0?0:c)>100?100:c,d.data.progress=c,d.states={WAITING:1,RECORDING:2,FINISHED:4,ERROR:3},d.stop=function(e){core.backend.request("recordings/"+this.data.id+"/stop",{version:3,method:"PUT",onload:function(r,o){r?e({code:t.errors.SERVER_ERROR,message:t.errorCodes[t.errors.SERVER_ERROR]}):o&&o.data&&!o.error?(t.events["stop"]&&t.emit("stop",{item:this,time:(new Date).getTime()}),e(null,!0)):e({code:t.errors.SERVER_ERROR,message:t.errorCodes[t.errors.SERVER_ERROR]})},onerror:function(){}})},t.hash[d.data.id]=d,t.records.push(d),u.addItem(d.data),t.events["add"]&&t.emit("add",{item:d,time:(new Date).getTime()}))}"function"==typeof e&&e()},onerror:function(t){"function"==typeof e&&e()}}):clearInterval(this.timerId)},i={isActive:!1,idToIndexHash:{},list:[],client:null,emitChange:function(e){try{i.idToIndexHash[e.id].data.state=d[e.state],i.idToIndexHash[e.id].events["stop"]&&i.idToIndexHash[e.id].emit("change")}catch(e){}},emitProgress:function(e){try{i.idToIndexHash[e.id].data.progress=e.progress,i.idToIndexHash[e.id].events["change"]&&i.idToIndexHash[e.id].emit("change")}catch(e){}},addItem:function(e){var t=new n;t.id=e.id,t.layout=a.layouts.record,t.geometry=a.geometry.horizontal,t.data={name:e.name,progress:e.progress,state:d[e.state],url:function(t){c.getUrl(e.id,t)},mime:"content/video"},i.idToIndexHash[e.id]=t,i.list.push(t);try{c.events["add"]&&c.emit("add",[t])}catch(e){}},removeItem:function(e){var t=i.list.splice(i.list.indexOf(i.idToIndexHash[e.id]),1);delete i.idToIndexHash[e.id];try{c.events["remove"]&&c.emit("remove",t)}catch(e){}}},c.getUrl=function(e,t){core.backend.request("recordings/"+e+"/link",{version:3,method:"GET",onload:function(e,r){if(e){try{r=JSON.parse(r).message}catch(e){r=e}t({code:l.prototype.errors.SERVER_ERROR,message:l.prototype.errorCodes[l.prototype.errors.SERVER_ERROR]})}else r.data&&r.data.url?t(null,r.data.url):t({code:l.prototype.errors.SERVER_ERROR,message:l.prototype.errorCodes[l.prototype.errors.SERVER_ERROR]})},onerror:function(){t({code:l.prototype.errors.SERVER_ERROR,message:l.prototype.errorCodes[l.prototype.errors.SERVER_ERROR]})}})},c.init=function(e,t){this.api=e,i.client=new l,i.client.enabled=!0,i.isActive=!0,i.client.update(function(){t({provider:c,data:u.list.map(function(e){var t=new n;return t.id=e.id,t.layout=a.layouts.record,t.geometry=a.geometry.horizontal,t.data={name:e.name,progress:e.progress,state:d[e.state],url:function(t){c.getUrl(e.id,t)},mime:"content/video"},i.idToIndexHash[e.id]=t,i.list.push(t),t})})})},c.search=function(e,t){t(!1,i.list.map(function(t){if(-1!==t.data.name.indexOf(e))return t}))},e.exports={onInit:function(e,t){s.load({name:core.environment.language,path:e.path+"lang"},function(){o=s.gettext,d=["",o("Scheduled recording"),o("Recording"),o("Recording error!"),o("Recorded")],t()})},onAppInit:function(e,t){t(null,new l)},onContentBoardInit:function(e,t){c.init(e.api,function(e){t(null,e)})}}},function(e,t,r){"use strict";var o=r(0),n=r(3),s=new o;function a(e){var t=new n(e);s._=s.gettext=t.gettext,s.pgettext=t.pgettext,s.ngettext=t.ngettext}s.defaultLanguage="en",s.load=function(e,t){var r;t=t||null,e.ext=e.ext||"json",e.path=e.path||"lang",e.name===s.defaultLanguage?(a(),null!==t&&t(null)):((r=new XMLHttpRequest).onload=function(){var e,o;try{o=JSON.parse(r.responseText)}catch(t){e=t}e?r.onerror(e):(a(o),null!==t&&t(null),s.events["load"]&&s.emit("load"))},r.ontimeout=r.onerror=function(e){a(),null!==t&&t(null),s.events["error"]&&s.emit("error",e)},r.open("GET",e.path+"/"+e.name+"."+e.ext,!0),r.send(null))},e.exports=s},function(module,exports,__webpack_require__){"use strict";function Gettext(config){var data,meta;config=config||{},data=config.data||{},data[""]=data[""]||{},meta=config.meta,this.gettext=function(e){return data[""][e]||e},this.pgettext=function(e,t){return data[e]&&data[e][t]||t},this.ngettext=function(msgId,plural,value){var n,evalResult;return data&&meta&&data[""][msgId]?(evalResult=eval("n = "+value+"; "+meta.plural),"boolean"==typeof evalResult&&(evalResult=+evalResult),data[""][msgId][evalResult]):1===value?msgId:plural}}Gettext.prototype.constructor=Gettext,module.exports=Gettext},function(e,t,r){"use strict";e.exports={layouts:{tvChannel:1,video:2,record:3,static:4,application:5},geometry:{square:1,horizontal:2,vertical:3,round:4},actions:{favorite:1,accessControl:2,expandItemContent:3}}}]);
//# sourceMappingURL=main.js.map