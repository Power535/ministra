module.exports=function(e){var r={};function t(a){if(r[a])return r[a].exports;var s=r[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,t),s.l=!0,s.exports}return t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var s in e)t.d(a,s,function(r){return e[r]}.bind(null,s));return a},t.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r,t){"use strict";var a="/ram/mnt/smb",s=!1,n=+gSTB.Version().split(";")[0].split(":")[1].trim(),o=!1,i={enabled:!0,workers:[],activeGroup:null,activeServer:null,data:{groups:null,servers:null,shares:null},groupsCacheTime:3600,serversCacheTime:300,sharesCacheTime:300,setup:function(e){-1===this.workers.indexOf(e)&&this.workers.push(e),e.setupTime=new Date},clear:function(){i.data.groups=null,i.data.servers=null,i.data.shares=null,i.activeGroup=null,i.activeServer=null,i.workers.forEach(function(e){delete e.setupTime}),i.workers=[]}};function u(e){var r,t,n,o;e&&e.address&&(e.address="/"===e.address.charAt(e.address.length-1)?e.address.substr(0,e.address.length-1):e.address,r=e.login||"guest",t=e.password||"",n='mount cifs "'+e.address+'" "'+(e.mountPath||a)+'" username='+r+",password="+t+",iocharset=utf8",o=gSTB.RDir(n).trim(),s="Ok"===o)}function l(e,r){var t,a,s;if("function"!=typeof e)throw new Error("[Network]::getGroups()> callback must be a function");if(r=typeof r!=typeof!0||r,i.enabled&&r)if(i.data.groups){if(!((new Date-l.setupTime)/1e3>i.groupsCacheTime))return void e(null,i.data.groups);i.setup(l),i.data.groups=null,i.activeGroup=null}else i.setup(l);function n(r){r.forEach(function(e){e&&t.push({name:e,uri:e,type:a.types.SAMBA_GROUP})}),e(null,i.data.groups=t),i.data.servers&&Object.keys(i.data.servers).forEach(function(e){-1===r.indexOf(e)&&delete i.data.servers[e]})}if(t=[],a=this,o)window.stbSmb.findGroups(function(r,t){r?e(r):Array.isArray(t)?n(t):e({message:"Invalid data format!"})});else{try{s=JSON.parse(gSTB.GetSmbGroups())}catch(r){return void e(r)}s&&Array.isArray(s.result)?n(s.result):e({message:"Invalid data format!"})}}function d(e,r,t){var a,s,u;if("function"!=typeof r)throw new Error("[Network]::getServers()> callback must be a function");if(t=typeof t!=typeof!0||t,i.enabled&&t)if(i.activeGroup=e.group,i.data.servers){if((new Date-d.setupTime)/1e3>i.serversCacheTime)i.setup(d),i.data.servers=null,i.activeServer=null;else if(i.data.servers[i.activeGroup])return void r(null,i.data.servers[i.activeGroup])}else i.setup(d);function l(t){t.forEach(function(r){r&&a.push({name:r,uri:e.group+"/"+r,type:s.types.SAMBA_HOST})}),i.data.servers=i.data.servers||{},i.data.servers[i.activeGroup]=a,r(null,a),i.data.shares&&Object.keys(i.data.shares).forEach(function(e){-1===t.indexOf(e)&&delete i.data.shares[e]})}if(a=[],s=this,o)window.stbSmb.findServers(342===n?e.group:e,function(e,t){e?r(e):Array.isArray(t)?l(t):r({message:"Invalid data format!"})});else{try{u=JSON.parse(gSTB.GetSmbServers(JSON.stringify(e)))}catch(e){return void r(e)}u&&Array.isArray(u.result)?l(u.result):r({message:"Invalid data format!"})}}function f(e,r,t){var a,u;if("function"!=typeof r)throw new Error("[Network]::getShares()> callback must be a function");if(t=typeof t!=typeof!0||t,s=!1,i.enabled&&t)if(i.activeServer=e.server,i.data.shares){if((new Date-f.setupTime)/1e3>i.sharesCacheTime)i.setup(f),i.data.shares=null;else if(i.data.shares[i.activeServer])return void r(null,i.data.shares[i.activeServer])}else i.setup(f);function l(e,t,s){t?r(t):(e.forEach(function(e){e&&a.push({name:e,addresses:s})}),i.data.shares=i.data.shares||{},i.data.shares[i.activeServer]=a,r(null,a))}if(a=[],o)342===n?window.stbSmb.findShares('""',e.server,function(t,a){t?r(t):Array.isArray(a)?window.stbSmb.findIp('""',e.server,function(e,r){l(a,e,r)}):r({message:"Invalid data format!"})}):window.stbSmb.findShares(e,function(t,a){t?r(t):Array.isArray(a)?window.stbSmb.findIps({server:e.server},function(e,r){l(a,e,r)}):r({message:"Invalid data format!"})});else{try{u=JSON.parse(gSTB.GetSmbShares(JSON.stringify(e)))}catch(e){return void r(e)}u&&u.result&&Array.isArray(u.result.shares)?(u.result.shares.forEach(function(e){e&&a.push({name:e,addresses:[u.result.serverIP].concat(u.result.additionalIPs||[])})}),i.data.shares=i.data.shares||{},i.data.shares[i.activeServer]=a,r(null,a)):r({message:"Invalid data format!"})}}function c(e,r){for(var t=0,a=e.addresses;t<a.length&&(u({address:"//"+a[t]+"/"+e.folder,login:e.login,password:e.password}),!s);)t+=1;setTimeout(function(){r(null,s)},0)}window.stbSmb&&n>=342&&(o=!0),e.exports={onAppInit:function(e,r){r(null,{config:e.app,types:{SAMBA_GROUP:0,SAMBA_HOST:1,SAMBA_SHARE:2},clearCache:i.clear,getGroups:l,getServers:d,getShares:f,openShare:c})}}}]);
//# sourceMappingURL=main.js.map